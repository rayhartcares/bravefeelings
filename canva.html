<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Understanding Anger</title>
  <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600&display=swap" rel="stylesheet">
  <style>
    /* --- THEME --- */
    body { margin: 0; padding: 0; background-color: #FFF8F0; font-family: 'Fredoka', sans-serif; color: #2D3748; display: flex; justify-content: center; min-height: 100vh; overflow-x: hidden; }
    #app-container { width: 100%; max-width: 800px; padding: 40px 20px; position: relative; }
    
    .white-card { background: white; border-radius: 24px; padding: 30px; box-shadow: 0 8px 20px rgba(0,0,0,0.05); text-align: center; margin-bottom: 24px; border-bottom: 6px solid #EDF2F7; position: relative; overflow: visible; transition: transform 0.2s;}
    .white-card:hover { transform: translateY(-5px); }
    
    .sticker-img { width: 120px; height: 120px; object-fit: contain; margin-bottom: 15px; filter: drop-shadow(0 5px 5px rgba(0,0,0,0.1)); z-index: 2; position: relative; }
    
    /* --- ANIMATIONS --- */
    @keyframes float { 0%, 100% { transform: translateY(0) scale(1); } 50% { transform: translateY(-10px) scale(1.05); } }
    .animate-float { animation: float 3s infinite ease-in-out; }

    /* Active Tool Animations */
    @keyframes melt-drip { 0% { transform: translateY(0) scale(1); opacity: 0.8; } 100% { transform: translateY(60px) scale(0.5); opacity: 0; } }
    @keyframes cool-pulse { 0% { transform: scale(0.8); opacity: 0.8; } 100% { transform: scale(2.5); opacity: 0; } }
    @keyframes roar-shake { 
        0% { transform: scale(1) rotate(0deg); } 
        10%, 90% { transform: scale(1.2) rotate(-5deg); } 
        20%, 80% { transform: scale(1.2) rotate(5deg); } 
        30%, 50%, 70% { transform: scale(1.2) rotate(-5deg); } 
        40%, 60% { transform: scale(1.2) rotate(5deg); } 
        100% { transform: scale(1) rotate(0deg); } 
    }
    @keyframes sound-blast { 0% { transform: scale(0.8); opacity: 1; border-width: 10px; } 100% { transform: scale(2.5); opacity: 0; border-width: 0px; } }

    .roaring { animation: roar-shake 0.8s ease-in-out; }
    .melting { transition: transform 10s linear; transform: scale(0.4) translateY(50px); }

    /* --- PARTICLES --- */
    .particle { position: absolute; border-radius: 50%; pointer-events: none; z-index: 1; }
    .water-drop { width: 10px; height: 15px; background: #90CDF4; border-radius: 50% 50% 30% 30%; animation: melt-drip 1s linear forwards; }
    .cool-aura { width: 100px; height: 100px; background: radial-gradient(circle, #4299E1 0%, transparent 70%); opacity: 0.5; animation: cool-pulse 2s infinite ease-out; position: absolute; top: 50%; left: 50%; margin-top: -50px; margin-left: -50px; z-index: 0;}
    .sound-wave { position: absolute; border: 4px solid #ECC94B; border-radius: 50%; width: 140px; height: 140px; top: 50%; left: 50%; margin-top: -70px; margin-left: -70px; opacity: 0; animation: sound-blast 1s ease-out forwards; pointer-events: none;}

    /* --- UI ELEMENTS --- */
    .title { font-size: 36px; font-weight: bold; text-align: center; margin-bottom: 10px; }
    .green-title { color: #48BB78; } .red-title { color: #E53E3E; }
    .card-title { font-size: 22px; font-weight: bold; margin-bottom: 8px; color: #2D3748; }
    .card-desc { font-size: 16px; color: #718096; line-height: 1.5; }
    
    .btn { padding: 14px 28px; border-radius: 16px; font-weight: bold; font-size: 18px; border: none; cursor: pointer; color: white; transition: all 0.2s; width: 100%; margin-top: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
    .btn:hover { transform: scale(1.02); filter: brightness(1.1); }
    .btn:disabled { opacity: 0.7; cursor: not-allowed; transform: none; }
    
    .btn-red { background: linear-gradient(135deg, #E53E3E, #C53030); }
    .btn-green { background: linear-gradient(135deg, #48BB78, #38A169); }
    .btn-blue { background: linear-gradient(135deg, #4299E1, #3182CE); }
    .btn-orange { background: linear-gradient(135deg, #ED8936, #C05621); }
    .btn-yellow { background: linear-gradient(135deg, #ECC94B, #D69E2E); color: #FFF; text-shadow: 0 1px 2px rgba(0,0,0,0.1); }
    .btn-gray { background: linear-gradient(135deg, #A0AEC0, #718096); }
    .btn-back { background: white; border: 2px solid #CBD5E0; color: #4A5568; padding: 8px 16px; border-radius: 12px; font-weight: bold; cursor: pointer; margin-bottom: 20px; }
    
    .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 25px; } 
    @media (max-width: 600px) { .grid-2 { grid-template-columns: 1fr; } }

    /* Mute Button & Debugger */
    #sound-toggle { position: absolute; top: 10px; right: 20px; background: white; border: 2px solid #CBD5E0; border-radius: 50%; width: 40px; height: 40px; font-size: 20px; cursor: pointer; display: flex; align-items: center; justify-content: center; z-index: 100; }
    #debug-msg { position: absolute; top: 15px; right: 70px; font-size: 12px; color: red; font-weight: bold; background: rgba(255,255,255,0.9); padding: 5px; border-radius: 5px; display: none; }
  </style>
</head>
<body>
  
  <div id="app-container"></div>
  <button id="sound-toggle" onclick="toggleMute()">üîä</button>
  <div id="debug-msg"></div>

  <audio id="bg-calm" loop>
      <source src="calm.mp3" type="audio/mpeg">
  </audio>

  <script>
    const container = document.getElementById('app-container');
    let isMuted = false;
    let calmMusic = document.getElementById('bg-calm');
    let musicAttempted = false;

    // --- SOUND MANAGER ---
    // This function tries to find the music if it failed the first time
    calmMusic.onerror = function() {
        if (!musicAttempted) {
            console.log("Root file not found, checking assets/ folder...");
            calmMusic.src = "assets/calm.mp3";
            musicAttempted = true;
            calmMusic.load();
        } else {
            document.getElementById('debug-msg').style.display = 'block';
            document.getElementById('debug-msg').innerText = "‚ùå Music file missing! Check filename.";
        }
    };

    function toggleMute() {
        isMuted = !isMuted;
        const btn = document.getElementById('sound-toggle');
        if (isMuted) {
            btn.innerText = "üîá";
            calmMusic.pause();
        } else {
            btn.innerText = "üîä";
            if (document.getElementById('solution-view')) {
                calmMusic.play().catch(e => console.log("Browser blocked autoplay"));
            }
        }
    }

    function playCalmMusic(play) {
        if (isMuted) return;
        if (play) {
            calmMusic.volume = 0.3;
            var promise = calmMusic.play();
            if (promise !== undefined) {
                promise.then(_ => {
                    document.getElementById('debug-msg').style.display = 'none'; // Success
                }).catch(error => {
                    console.log("Autoplay prevented.");
                });
            }
        } else {
            calmMusic.pause();
            calmMusic.currentTime = 0;
        }
    }

    // --- HOME & NEGATIVE VIEWS ---
    function showHome() { 
        playCalmMusic(false); // Stop music on home
        container.innerHTML = `<h1 class="title">Understanding Anger</h1><p style="text-align: center; color: #718096; margin-bottom: 40px;">Anger is big energy. Let's learn to control it!</p><div class="grid-2"><div class="white-card"><img src="https://raw.githubusercontent.com/Tarikul-Islam-Anik/Animated-Fluent-Emojis/master/Emojis/Travel%20and%20places/Volcano.png" class="sticker-img animate-float"><div class="card-title">The Anger Volcano</div><p class="card-desc">Ready to explode?</p><button onclick="showNegative()" class="btn btn-red">See Explosion</button></div><div class="white-card"><img src="https://raw.githubusercontent.com/Tarikul-Islam-Anik/Animated-Fluent-Emojis/master/Emojis/Smilies/Relieved%20Face.png" class="sticker-img animate-float"><div class="card-title">Cool Down Tools</div><p class="card-desc">Smart ways to chill.</p><button onclick="showSolutions()" class="btn btn-green">Show Solutions</button></div></div><div style="text-align: center; margin-top: 30px;"><a href="index.html" style="color: #A0AEC0; text-decoration: none; font-weight: bold;">‚Üê Back to Menu</a></div>`;
    }

    function showNegative() { 
        container.innerHTML = `<button onclick="showHome()" class="btn-back">‚Üê Back</button><h1 class="title red-title">When Anger Explodes! üí•</h1><div class="grid-2" style="margin-top: 30px;"><div class="white-card"><img src="https://raw.githubusercontent.com/Tarikul-Islam-Anik/Animated-Fluent-Emojis/master/Emojis/Smilies/Exploding%20Head.png" class="sticker-img"><div class="card-title">Brain Freeze</div></div><div class="white-card"><img src="https://raw.githubusercontent.com/Tarikul-Islam-Anik/Animated-Fluent-Emojis/master/Emojis/Smilies/Broken%20Heart.png" class="sticker-img"><div class="card-title">Feelings Hurt</div></div><div class="white-card"><img src="https://raw.githubusercontent.com/Tarikul-Islam-Anik/Animated-Fluent-Emojis/master/Emojis/Travel%20and%20places/Fire.png" class="sticker-img"><div class="card-title">Body Overheat</div></div><div class="white-card"><img src="https://raw.githubusercontent.com/Tarikul-Islam-Anik/Animated-Fluent-Emojis/master/Emojis/Smilies/Crying%20Face.png" class="sticker-img"><div class="card-title">The Aftermath</div></div></div><div class="white-card" style="margin-top: 30px; border-bottom-color: #48BB78;"><p style="font-weight: bold; font-size: 20px; color: #2F855A;">üí° You can control it!</p><button onclick="showSolutions()" class="btn btn-green" style="width: auto;">Learn Cool Down Powers</button></div>`;
    }

    // --- SOLUTIONS VIEW ---
    function showSolutions() {
      playCalmMusic(true); // START MUSIC
      container.innerHTML = `
        <div id="solution-view"></div>
        <button onclick="showHome()" class="btn-back">‚Üê Back</button>
        <h1 class="title green-title">Your Cool Down Powers üõ°Ô∏è</h1>
        <div style="display: flex; flex-direction: column; gap: 30px; margin-top: 30px;">

          <div class="white-card" style="text-align: left; border-bottom-color: #48BB78;">
             <div style="text-align: center;">
                 <div id="breath-circle" style="width: 120px; height: 120px; background: linear-gradient(135deg, #48BB78, #81E6D9); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 20px; margin: 0 auto 20px auto; transition: transform 4s, background 4s; box-shadow: 0 10px 20px rgba(72, 187, 120, 0.3);">Breathe</div>
             </div>
             <div class="card-title" style="text-align: center; color: #48BB78; margin-top: 10px;">Deep Breathing</div>
             <p class="card-desc" style="text-align: center;">Slows down your heart rate. Breathe in... Breathe out...</p>
             <button onclick="toggleBreath()" class="btn btn-green">Start Breathing</button>
          </div>

          <div class="white-card" style="text-align: left; border-bottom-color: #ED8936;">
             <div style="text-align: center;"><img src="https://raw.githubusercontent.com/Tarikul-Islam-Anik/Animated-Fluent-Emojis/master/Emojis/People/Person%20Running.png" class="sticker-img animate-float"></div>
             <div class="card-title" style="text-align: center; color: #ED8936;">Move Your Body</div>
             <p class="card-desc" style="text-align: center;">Shake off the angry energy! Jump or run for 10 seconds.</p>
             <div style="text-align: center; font-size: 40px; font-weight: bold; color: #ED8936; height: 50px;" id="move-timer"></div>
             <button onclick="startMove()" class="btn btn-orange">Start 10s Burst</button>
          </div>

          <div class="white-card" id="ice-card" style="text-align: left; border-bottom-color: #4299E1; min-height: 380px;">
             <div class="cool-aura" id="ice-aura" style="display:none;"></div>
             <div style="text-align: center; height: 150px;">
                 <img src="https://raw.githubusercontent.com/Tarikul-Islam-Anik/Animated-Fluent-Emojis/master/Emojis/Food/Ice.png" id="ice-img" class="sticker-img animate-float" style="z-index: 2;">
             </div>
             <div class="card-title" style="text-align: center; color: #4299E1;">The Gradual Melt</div>
             <p class="card-desc" style="text-align: center;">Hold the ice. Feel the cold slowly spread and melt away the anger.</p>
             <div style="text-align: center;">
                <p id="ice-msg" style="color: #3182CE; font-weight: bold; height: 25px; font-size: 16px; margin-bottom: 5px;"></p>
                <button id="ice-btn" onclick="startIceMelt()" class="btn btn-blue">Start Melting (10s)</button>
             </div>
          </div>

          <div class="white-card" id="speak-card" style="text-align: left; border-bottom-color: #ECC94B;">
             <div style="text-align: center; position: relative;">
                 <img src="https://raw.githubusercontent.com/Tarikul-Islam-Anik/Animated-Fluent-Emojis/master/Emojis/Objects/Microphone.png" id="speak-img" class="sticker-img animate-float">
             </div>
             <div class="card-title" style="text-align: center; color: #D69E2E;">Speak Your Power!</div>
             <p class="card-desc" style="text-align: center;">Don't keep it inside. Roar your truth with words!</p>
             <div id="speak-box" style="background-color: #FFFFF0; padding: 15px; border-radius: 16px; border: 3px dashed #ECC94B; text-align: center; transition: all 0.3s; margin: 10px 0;">
                <p id="speak-text" style="font-weight: bold; color: #D69E2E; font-size: 18px; margin:0;">"I feel ANGRY when..."</p>
             </div>
             <button id="speak-btn" onclick="startShout()" class="btn btn-yellow">SHOUT IT OUT!</button>
          </div>

          <div class="white-card" style="text-align: left; border-bottom-color: #A0AEC0;">
             <div style="text-align: center;"><img src="https://raw.githubusercontent.com/Tarikul-Islam-Anik/Animated-Fluent-Emojis/master/Emojis/Travel%20and%20places/Hourglass%20Not%20Done.png" class="sticker-img animate-float"></div>
             <div class="card-title" style="text-align: center; color: #4A5568;">Tactical Retreat</div>
             <p class="card-desc" style="text-align: center;">Walk away to recharge. Come back when you are in control.</p>
             <div style="text-align: center;">
                <div id="timeout-timer" style="font-size: 30px; font-weight: bold; color: #4A5568; margin: 10px 0;">5:00</div>
                <button onclick="startTimeOut()" class="btn btn-gray">Start 5-Min Timer</button>
             </div>
          </div>

        </div>
      `;
    }

    // --- TOOL LOGIC ---
    let breathInterval;
    function toggleBreath() {
       const circle = document.getElementById('breath-circle');
       if(circle.style.transform.includes("scale(1.5)")) {
          circle.style.transform = "scale(1)"; circle.innerText = "Breathe"; clearInterval(breathInterval);
       } else {
          circle.innerText = "In..."; circle.style.transform = "scale(1.5)"; 
          breathInterval = setInterval(() => {
             if(circle.innerText === "In...") { circle.innerText = "Out..."; circle.style.transform = "scale(1)"; } 
             else { circle.innerText = "In..."; circle.style.transform = "scale(1.5)"; }
          }, 4000);
       }
    }

    function startMove() {
       let t = 10; const timer = document.getElementById('move-timer'); timer.innerText = t;
       const i = setInterval(() => { t--; timer.innerText = t; 
       if(t<=0) { clearInterval(i); timer.innerText = "Great Job! üéâ"; } }, 1000);
    }

    function startIceMelt() {
        const iceBtn = document.getElementById('ice-btn');
        const iceImg = document.getElementById('ice-img');
        const iceMsg = document.getElementById('ice-msg');
        const iceAura = document.getElementById('ice-aura');
        
        iceBtn.disabled = true; iceBtn.innerText = "Melting...";
        iceImg.classList.remove('animate-float'); iceImg.classList.add('melting');
        iceAura.style.display = "block";

        let timeLeft = 10;
        iceMsg.innerText = "Applying cold... heat dropping.";

        // Drip particles
        const dripInterval = setInterval(() => {
            const rect = iceImg.getBoundingClientRect(); 
            // Safety check in case user switches page quickly
            if (!document.getElementById('ice-card')) { clearInterval(dripInterval); return; }
            const cardRect = document.getElementById('ice-card').getBoundingClientRect();
            const drop = document.createElement('div');
            drop.classList.add('particle', 'water-drop');
            drop.style.left = (rect.left + rect.width/2 - cardRect.left) + (Math.random()*20-10) + 'px';
            drop.style.top = (rect.top + rect.height/2 - cardRect.top) + 'px';
            document.getElementById('ice-card').appendChild(drop);
            setTimeout(() => drop.remove(), 1000);
        }, 300);

        const meltTimer = setInterval(() => {
            timeLeft--;
            if(timeLeft > 7) iceMsg.innerText = "Applying cold...";
            else if(timeLeft > 3) iceMsg.innerText = "ü•∂ Breathing slower...";
            else if(timeLeft > 0) iceMsg.innerText = "üíß Almost melted...";
            else {
                clearInterval(meltTimer); clearInterval(dripInterval);
                iceMsg.innerText = "‚ú® Relief achieved.";
                iceAura.style.display = "none"; iceBtn.innerText = "Melt Again"; iceBtn.disabled = false;
                iceImg.classList.remove('melting');
                setTimeout(() => iceImg.classList.add('animate-float'), 1000);
            }
        }, 1000);
    }

    function startShout() {
        const speakBtn = document.getElementById('speak-btn');
        const speakImg = document.getElementById('speak-img');
        const speakBox = document.getElementById('speak-box');
        const speakCard = document.getElementById('speak-card');

        speakBtn.disabled = true; speakBtn.innerText = "ROARING!!!";
        speakImg.classList.remove('animate-float');
        speakImg.classList.add('roaring'); 
        
        speakBox.style.transform = "scale(1.1)"; speakBox.style.borderColor = "#E53E3E";

        // Sound blast waves
        for(let i=0; i<3; i++) {
            setTimeout(() => {
                const wave = document.createElement('div');
                wave.classList.add('sound-wave');
                speakCard.appendChild(wave);
                setTimeout(() => wave.remove(), 1000);
            }, i * 300);
        }

        setTimeout(() => {
            speakImg.classList.remove('roaring'); speakImg.classList.add('animate-float');
            speakBtn.innerText = "SHOUT IT OUT!"; speakBtn.disabled = false;
            speakBox.style.transform = "scale(1)"; speakBox.style.borderColor = "#ECC94B";
        }, 2000);
    }

    function startTimeOut() {
        let t = 300; const timer = document.getElementById('timeout-timer');
        const i = setInterval(() => {
            t--; const m = Math.floor(t / 60); const s = t % 60;
            timer.innerText = `${m}:${s < 10 ? '0' : ''}${s}`;
            if(t<=0) { clearInterval(i); timer.innerText = "Done!"; }
        }, 1000);
    }

    // Initialize
    showHome();
  </script>
</body>
</html>
