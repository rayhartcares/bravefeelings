<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Understanding Embarrassed</title>

  <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600;700;800&display=swap" rel="stylesheet">

  <style>
    body{
      margin:0; padding:0;
      background:#F4FAFF;
      font-family:'Fredoka',sans-serif;
      color:#1F2937;
      display:flex; justify-content:center;
      min-height:100vh;
      overflow-x:hidden;
    }
    #app-container{
      width:100%;
      max-width:860px;
      padding:44px 18px;
      position:relative;
    }

    .white-card{
      background:#fff;
      border-radius:26px;
      padding:30px;
      box-shadow:0 10px 26px rgba(0,0,0,0.06);
      text-align:center;
      margin-bottom:24px;
      border-bottom:7px solid #E5E7EB;
      position:relative;
      overflow:visible;
      transition:transform .18s ease;
    }
    .white-card:hover{ transform:translateY(-4px); }

    .title{
      font-size:40px;
      font-weight:800;
      text-align:center;
      margin:0 0 8px 0;
      letter-spacing:.2px;
      color:#0F172A;
    }
    .subtitle{
      text-align:center;
      color:#64748B;
      margin:0 0 10px 0;
      font-size:18px;
      line-height:1.45;
    }
    .support{
      text-align:center;
      color:#0F172A;
      margin:0 0 34px 0;
      font-size:16px;
      line-height:1.45;
      font-weight:800;
      opacity:.86;
    }

    .rose-title{ color:#FB7185; }
    .violet-title{ color:#7C3AED; }
    .cyan-title{ color:#06B6D4; }
    .amber-title{ color:#D97706; }

    .card-title{
      font-size:22px;
      font-weight:800;
      margin:12px 0 6px 0;
      color:#0F172A;
    }
    .card-desc{
      font-size:16px;
      color:#64748B;
      line-height:1.55;
      margin:0;
    }

    .btn{
      padding:14px 22px;
      border-radius:16px;
      font-weight:800;
      font-size:18px;
      border:none;
      cursor:pointer;
      color:#fff;
      transition:transform .2s ease, filter .2s ease;
      width:100%;
      margin-top:16px;
      box-shadow:0 7px 16px rgba(0,0,0,0.12);
      pointer-events:auto;
    }
    .btn:hover{ transform:scale(1.02); filter:brightness(1.06); }
    .btn:disabled{ opacity:.75; cursor:not-allowed; transform:none; }

    .btn-rose   { background:linear-gradient(135deg,#FB7185,#E11D48); }
    .btn-violet { background:linear-gradient(135deg,#A78BFA,#7C3AED); }
    .btn-cyan   { background:linear-gradient(135deg,#22D3EE,#06B6D4); }
    .btn-amber  { background:linear-gradient(135deg,#FBBF24,#D97706); }
    .btn-slate  { background:linear-gradient(135deg,#94A3B8,#475569); }

    .btn-back{
      background:#fff;
      border:2px solid #CBD5E1;
      color:#334155;
      padding:9px 16px;
      border-radius:14px;
      font-weight:800;
      cursor:pointer;
      margin-bottom:18px;
      pointer-events:auto;
    }

    .grid-2{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:22px;
    }
    @media (max-width:650px){ .grid-2{ grid-template-columns:1fr; } }

    .mini-panel{
      background:#F8FAFC;
      border:2px dashed #CBD5E1;
      border-radius:18px;
      padding:14px;
      margin-top:12px;
      text-align:center;
      line-height:1.45;
    }

    .pillRow{
      margin-top:12px;
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      justify-content:center;
    }
    .pillTag{
      display:inline-block;
      padding:6px 12px;
      border-radius:999px;
      font-weight:800;
      font-size:13px;
      margin-top:0;
      background:#FFE4E6;
      color:#9F1239;
      border:2px solid #FECDD3;
    }
    .pillTag.trig{
      background:#EDE9FE;
      border-color:#DDD6FE;
      color:#5B21B6;
    }

    .toolsStack{ display:flex; flex-direction:column; gap:26px; margin-top:18px; }

    .timerBig{
      font-size:34px;
      font-weight:900;
      margin-top:10px;
      color:#0F172A;
      min-height:44px;
    }
    .progressBar{
      width:100%;
      height:12px;
      background:#E2E8F0;
      border-radius:999px;
      overflow:hidden;
      margin-top:10px;
      border:2px solid #CBD5E1;
    }
    .progressFill{
      width:0%;
      height:100%;
      background:linear-gradient(135deg,#FB7185,#7C3AED);
      border-radius:999px;
      transition:width .18s ease;
    }
    .toolBtnRow{
      display:flex;
      gap:10px;
      justify-content:center;
      flex-wrap:wrap;
      margin-top:14px;
    }
    .toolBtnRow .btn{
      width:auto;
      margin-top:0;
      padding:12px 16px;
      font-size:16px;
      border-radius:14px;
    }

    .field{ text-align:left; margin-top:12px; }
    .label{ font-weight:900; color:#0F172A; margin-bottom:6px; display:block; }
    input[type="text"], textarea, select{
      width:100%;
      border-radius:16px;
      border:2px solid #CBD5E1;
      padding:12px 12px;
      font-family:inherit;
      font-weight:800;
      color:#0F172A;
      outline:none;
      background:#fff;
      box-shadow:inset 0 1px 0 rgba(255,255,255,0.7);
    }
    textarea{ min-height:92px; resize:vertical; }

    .split2{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:14px;
      margin-top:12px;
      text-align:left;
    }
    @media (max-width:650px){ .split2{ grid-template-columns:1fr; } }

    .miniBox{
      background:#fff;
      border:2px solid #E2E8F0;
      border-radius:18px;
      padding:12px;
      box-shadow:0 8px 18px rgba(0,0,0,0.06);
    }
    .miniBox h4{
      margin:0 0 8px 0;
      font-size:14px;
      font-weight:900;
      color:#0F172A;
    }
    .miniBox p{
      margin:0;
      font-weight:800;
      color:#475569;
      line-height:1.4;
      white-space:pre-wrap;
    }

    .phasePill{
      display:inline-block;
      padding:6px 12px;
      border-radius:999px;
      font-weight:900;
      font-size:13px;
      background:#EDE9FE;
      color:#5B21B6;
      border:2px solid #DDD6FE;
    }

    .tinyNote{
      margin-top:10px;
      color:#64748B;
      font-weight:800;
      font-size:13px;
      line-height:1.35;
    }

    .clickable-card{ cursor:pointer; }

    /* --- Interaction micro-animations --- */
    @keyframes pop {
      0%{ transform:scale(1); }
      45%{ transform:scale(1.08); }
      100%{ transform:scale(1); }
    }
    .popIt{ animation:pop .28s ease-out; }

    /* =========================
       ILLUSTRATION SYSTEM
       ========================= */
    .illus3d{
      width:210px;
      height:170px;
      margin:0 auto 6px auto;
      position:relative;
      display:flex;
      align-items:center;
      justify-content:center;
      filter:drop-shadow(0 18px 18px rgba(0,0,0,0.16));
      user-select:none;
      pointer-events:none; /* never block card clicks */
    }

    /* --- Cute kid base --- */
    .kid{
      --skin1:#FFD6B8;
      --skin2:#FFB98A;
      --hair1:#3B2F2F;
      --hair2:#1F1A1A;
      --shirt1:#A78BFA;
      --shirt2:#7C3AED;
      --pants1:#93C5FD;
      --pants2:#2563EB;
      --blush:#FB7185;
      width:128px;
      height:150px;
      position:relative;
      transform:translateY(4px);
    }
    .head{
      width:78px; height:78px;
      border-radius:50%;
      background:linear-gradient(135deg,var(--skin1),var(--skin2));
      position:absolute;
      left:50%; top:0;
      transform:translateX(-50%);
      box-shadow:inset 0 10px 16px rgba(255,255,255,0.35), inset 0 -10px 16px rgba(0,0,0,0.10);
    }
    .hair{
      position:absolute;
      width:84px; height:52px;
      left:50%; top:-2px;
      transform:translateX(-50%);
      background:linear-gradient(135deg,var(--hair1),var(--hair2));
      border-radius:42px 42px 36px 36px;
      clip-path:polygon(0 55%, 12% 30%, 28% 20%, 44% 24%, 58% 18%, 74% 24%, 88% 34%, 100% 58%, 100% 0, 0 0);
      opacity:.98;
    }
    .face{
      position:absolute;
      inset:0;
    }
    .eyes{
      position:absolute;
      left:50%; top:34px;
      transform:translateX(-50%);
      display:flex;
      gap:14px;
    }
    .eye{
      width:9px; height:9px;
      background:rgba(15,23,42,0.75);
      border-radius:50%;
      box-shadow:0 2px 0 rgba(255,255,255,0.18);
    }
    .brows{
      position:absolute;
      left:50%; top:26px;
      transform:translateX(-50%);
      display:flex;
      gap:18px;
      opacity:.85;
    }
    .brow{
      width:16px; height:6px;
      border-radius:999px;
      background:rgba(15,23,42,0.35);
      transform:rotate(-8deg);
    }
    .brow.r{ transform:rotate(8deg); }
    .mouth{
      position:absolute;
      left:50%; top:52px;
      transform:translateX(-50%);
      width:18px; height:10px;
      border:3px solid rgba(15,23,42,0.55);
      border-left:0; border-right:0; border-top:0;
      border-radius:0 0 16px 16px;
      opacity:.9;
    }
    .blush{
      position:absolute;
      top:44px;
      width:16px; height:10px;
      border-radius:999px;
      background:rgba(251,113,133,0.35);
      filter:blur(.2px);
    }
    .blush.l{ left:16px; }
    .blush.r{ right:16px; }

    .body{
      width:88px; height:62px;
      border-radius:26px;
      background:linear-gradient(135deg,var(--shirt1),var(--shirt2));
      position:absolute;
      left:50%; top:72px;
      transform:translateX(-50%);
      box-shadow:inset 0 10px 14px rgba(255,255,255,0.30), inset 0 -10px 14px rgba(0,0,0,0.12);
    }
    .pants{
      width:74px; height:40px;
      border-radius:18px;
      background:linear-gradient(135deg,var(--pants1),var(--pants2));
      position:absolute;
      left:50%; top:120px;
      transform:translateX(-50%);
      box-shadow:inset 0 8px 12px rgba(255,255,255,0.25), inset 0 -8px 12px rgba(0,0,0,0.10);
    }
    .leg{
      width:14px; height:28px;
      border-radius:999px;
      background:linear-gradient(135deg,var(--pants2),#1E40AF);
      position:absolute;
      top:146px;
    }
    .leg.l{ left:44px; }
    .leg.r{ right:44px; }
    .shoe{
      width:20px; height:10px;
      border-radius:10px;
      background:#0F172A;
      position:absolute;
      top:172px;
    }
    .shoe.l{ left:36px; }
    .shoe.r{ right:36px; }

    .arm{
      width:18px; height:54px;
      border-radius:999px;
      background:linear-gradient(135deg,var(--skin1),var(--skin2));
      position:absolute;
      top:84px;
      box-shadow:inset 0 6px 10px rgba(255,255,255,0.18);
      transform-origin:top center;
    }
    .hand{
      width:24px; height:18px;
      border-radius:14px;
      background:linear-gradient(135deg,var(--skin1),var(--skin2));
      position:absolute;
      bottom:-6px;
      left:50%;
      transform:translateX(-50%);
      box-shadow:inset 0 6px 10px rgba(255,255,255,0.18);
    }

    /* --- Spotlight rig (Home + consequence) --- */
    .spotRig{
      width:210px; height:170px;
      position:relative;
      display:flex; align-items:center; justify-content:center;
      pointer-events:none;
    }
    .spotLight{
      position:absolute;
      left:50%; top:6px;
      transform:translateX(-50%);
      width:70px; height:28px;
      border-radius:999px;
      background:linear-gradient(135deg,#E2E8F0,#94A3B8);
      box-shadow:inset 0 8px 14px rgba(255,255,255,0.35), inset 0 -8px 14px rgba(0,0,0,0.12);
    }
    .spotCone{
      position:absolute;
      left:50%; top:26px;
      transform:translateX(-50%);
      width:0; height:0;
      border-left:88px solid transparent;
      border-right:88px solid transparent;
      border-top:128px solid rgba(251,113,133,0.18);
      filter:blur(.2px);
      opacity:.9;
      transition:all .18s ease;
    }
    .spotCone.big{
      border-left-width:92px; border-right-width:92px;
      border-top-color:rgba(251,113,133,0.20);
    }
    .spotCone.med{
      border-left-width:74px; border-right-width:74px;
      border-top-color:rgba(124,58,237,0.18);
    }
    .spotCone.small{
      border-left-width:56px; border-right-width:56px;
      border-top-color:rgba(6,182,212,0.16);
    }
    @keyframes conePulse{
      0%,100%{ opacity:.75; transform:translateX(-50%) scale(1); }
      50%{ opacity:1; transform:translateX(-50%) scale(1.04); }
    }
    .spotCone.pulse{ animation:conePulse 1.5s infinite ease-in-out; }

    @keyframes winceSway{
      0%,100%{ transform:translateY(4px) rotate(0deg); }
      40%{ transform:translateY(2px) rotate(-2deg); }
      70%{ transform:translateY(6px) rotate(2deg); }
    }
    .kid.wince{ animation:winceSway 1.35s infinite ease-in-out; }
    @keyframes blushPulse{
      0%,100%{ opacity:.25; }
      50%{ opacity:.55; }
    }
    .kid .blush.pulse{ animation:blushPulse 1.2s infinite ease-in-out; }

    /* --- Hide face --- */
    .kid.hideFace .arm.l{ left:18px; transform:rotate(28deg); }
    .kid.hideFace .arm.r{ right:18px; transform:rotate(-28deg); }
    .kid.hideFace .hand{ width:30px; height:22px; bottom:16px; }
    .kid.hideFace .eyes, .kid.hideFace .mouth, .kid.hideFace .brows{ opacity:.25; }
    @keyframes peek{
      0%,100%{ transform:translateY(4px) }
      40%{ transform:translateY(0px) }
      55%{ transform:translateY(0px) }
    }
    .kid.hideFace{ animation:peek 1.55s infinite ease-in-out; }

    /* --- Nervous laugh --- */
    .kid.nervous .arm.l{ left:16px; transform:rotate(12deg); }
    .kid.nervous .arm.r{
      right:14px; top:74px;
      height:58px;
      transform:rotate(-52deg);
    }
    .kid.nervous .hand{ bottom:-10px; }
    .kid.nervous .mouth{
      width:22px; height:14px;
      border:3px solid rgba(15,23,42,0.55);
      border-top:0; border-left:0; border-right:0;
      border-radius:0 0 22px 22px;
      opacity:.95;
    }
    @keyframes awkwardSmile{
      0%,100%{ transform:translateX(-50%) scaleX(1); }
      50%{ transform:translateX(-50%) scaleX(.72); }
    }
    .kid.nervous .mouth{ animation:awkwardSmile 1.0s infinite ease-in-out; }
    .talkBubble{
      position:absolute;
      right:6px; top:34px;
      width:52px; height:36px;
      border-radius:18px;
      background:#fff;
      border:2px solid #E2E8F0;
      box-shadow:0 10px 14px rgba(0,0,0,0.08);
    }
    .talkBubble:after{
      content:"";
      position:absolute;
      left:10px; bottom:-10px;
      width:14px; height:14px;
      background:#fff;
      border-left:2px solid #E2E8F0;
      border-bottom:2px solid #E2E8F0;
      transform:rotate(45deg);
      border-radius:4px;
    }
    @keyframes bubbleWiggle{
      0%,100%{ transform:rotate(0deg) translateY(0); }
      50%{ transform:rotate(3deg) translateY(-2px); }
    }
    .talkBubble.wiggle{ animation:bubbleWiggle .9s infinite ease-in-out; }

    /* --- Freeze --- */
    .kid.freeze{ filter:drop-shadow(0 0 18px rgba(6,182,212,0.25)); }
    .kid.freeze .arm.l{ left:14px; transform:rotate(4deg); }
    .kid.freeze .arm.r{ right:14px; transform:rotate(-4deg); }
    .kid.freeze .mouth{ width:12px; height:10px; border:0; background:rgba(15,23,42,0.35); border-radius:8px; top:56px; }
    @keyframes tinyShiver{
      0%,100%{ transform:translateY(4px) translateX(0); }
      50%{ transform:translateY(4px) translateX(1.5px); }
    }
    .kid.freeze{ animation:tinyShiver .28s infinite ease-in-out; }
    .iceSpark{
      position:absolute;
      width:10px; height:10px;
      border-radius:4px;
      background:rgba(34,211,238,0.9);
      box-shadow:0 0 18px rgba(34,211,238,0.5);
      opacity:.35;
    }
    @keyframes sparkRise{
      0%{ transform:translateY(0) scale(.7); opacity:.1; }
      40%{ opacity:.45; }
      100%{ transform:translateY(-26px) scale(1.35); opacity:0; }
    }
    .iceSpark.rise{ animation:sparkRise 1.1s infinite ease-in-out; }

    /* --- Defensive --- */
    .kid.defensive .arm.l{
      left:26px; top:96px; height:42px;
      transform:rotate(78deg);
    }
    .kid.defensive .arm.r{
      right:26px; top:96px; height:42px;
      transform:rotate(-78deg);
    }
    .kid.defensive .mouth{
      width:18px; height:10px;
      border:0;
      border-top:4px solid rgba(15,23,42,0.55);
      border-radius:16px;
      top:58px;
    }
    .kid.defensive .brow{ transform:rotate(12deg); }
    .kid.defensive .brow.r{ transform:rotate(-12deg); }
    .shield{
      position:absolute;
      left:20px; top:92px;
      width:44px; height:56px;
      border-radius:14px;
      background:linear-gradient(135deg,#E0E7FF,#6366F1);
      box-shadow:inset 0 10px 14px rgba(255,255,255,0.35), inset 0 -10px 14px rgba(0,0,0,0.12);
      clip-path:polygon(50% 0%, 92% 18%, 92% 56%, 50% 100%, 8% 56%, 8% 18%);
      opacity:.95;
      transform:rotate(-10deg);
    }
    @keyframes shieldPop{
      0%,100%{ transform:rotate(-10deg) scale(1); }
      50%{ transform:rotate(-10deg) scale(1.12); }
    }
    .shield.pop{ animation:shieldPop .8s infinite ease-in-out; }

    /* --- Door avoid rig --- */
    .doorRig{
      width:210px; height:170px;
      position:relative;
      display:flex; align-items:center; justify-content:center;
    }
    .doorEdge{
      position:absolute;
      left:26px; top:28px;
      width:64px; height:118px;
      border-radius:18px;
      background:linear-gradient(135deg,#E2E8F0,#CBD5E1);
      box-shadow:inset 0 10px 16px rgba(255,255,255,0.35), inset 0 -10px 16px rgba(0,0,0,0.10);
    }
    .doorEdge:after{
      content:"";
      position:absolute;
      right:10px; top:50%;
      transform:translateY(-50%);
      width:10px; height:10px;
      border-radius:50%;
      background:#94A3B8;
      opacity:.75;
    }
    @keyframes doorSlide{
      0%,100%{ transform:translateX(0); }
      50%{ transform:translateX(-3px); }
    }
    .doorEdge.slide{ animation:doorSlide 1.4s infinite ease-in-out; }

    @keyframes stepBack{
      0%,100%{ transform:translateY(4px) translateX(20px); }
      50%{ transform:translateY(4px) translateX(10px); }
    }
    .kid.stepBack{ animation:stepBack 1.4s infinite ease-in-out; }

    /* --- Mirror + scribble --- */
    .mirrorRig{
      width:210px; height:170px;
      position:relative;
      display:flex; align-items:center; justify-content:center;
    }
    .mirror{
      position:absolute;
      left:20px; top:30px;
      width:78px; height:110px;
      border-radius:22px;
      background:linear-gradient(135deg,#FFFFFF,#F1F5F9);
      border:2px solid #E2E8F0;
      box-shadow:0 12px 18px rgba(0,0,0,0.08);
    }
    .mirror:after{
      content:"";
      position:absolute;
      inset:10px;
      border-radius:16px;
      background:linear-gradient(135deg,rgba(99,102,241,0.08),rgba(6,182,212,0.10));
    }
    .scribble{
      position:absolute;
      right:20px; top:24px;
      width:72px; height:72px;
      border-radius:50%;
      border:4px solid rgba(124,58,237,0.25);
      border-top-color:rgba(251,113,133,0.55);
      border-left-color:rgba(6,182,212,0.35);
      filter:drop-shadow(0 10px 14px rgba(0,0,0,0.08));
      opacity:.9;
    }
    @keyframes swirl{
      0%{ transform:rotate(0deg) scale(0.95); }
      100%{ transform:rotate(360deg) scale(0.95); }
    }
    .scribble.spin{ animation:swirl 1.9s linear infinite; }

    /* --- Miss out rig (no other people) --- */
    .missRig{
      width:210px; height:170px;
      position:relative;
      display:flex; align-items:center; justify-content:center;
    }
    .playSign{
      position:absolute;
      right:18px; top:26px;
      width:62px; height:44px;
      border-radius:16px;
      background:linear-gradient(135deg,#DCFCE7,#22C55E);
      box-shadow:inset 0 10px 14px rgba(255,255,255,0.35), inset 0 -10px 14px rgba(0,0,0,0.12);
      opacity:.92;
    }
    .playSign:after{
      content:"";
      position:absolute;
      left:50%; top:50%;
      transform:translate(-50%,-50%);
      width:0; height:0;
      border-left:14px solid rgba(255,255,255,0.95);
      border-top:10px solid transparent;
      border-bottom:10px solid transparent;
      border-radius:4px;
      opacity:.95;
    }
    .ball{
      position:absolute;
      left:26px; bottom:26px;
      width:26px; height:26px;
      border-radius:50%;
      background:linear-gradient(135deg,#FDE68A,#F59E0B);
      box-shadow:inset 0 10px 14px rgba(255,255,255,0.35), inset 0 -10px 14px rgba(0,0,0,0.12);
    }
    @keyframes ballBob{
      0%,100%{ transform:translateY(0); }
      50%{ transform:translateY(-10px); }
    }
    .ball.bob{ animation:ballBob 1.2s infinite ease-in-out; }

    /* =========================
       TOOL ILLUSTRATIONS
       ========================= */

    /* Cool cheeks */
    .coolPack{
      position:absolute;
      left:50%; top:38px;
      transform:translateX(-50%);
      width:56px; height:34px;
      border-radius:18px;
      background:linear-gradient(135deg,#CFFAFE,#06B6D4);
      box-shadow:inset 0 10px 14px rgba(255,255,255,0.35), inset 0 -10px 14px rgba(0,0,0,0.12);
      opacity:.95;
    }
    .coolPack:after{
      content:"";
      position:absolute;
      inset:8px 10px;
      border-radius:14px;
      background:rgba(255,255,255,0.25);
    }
    .breathWave{
      position:absolute;
      left:50%; top:102px;
      transform:translateX(-50%);
      width:88px; height:14px;
      border-radius:999px;
      border:3px solid rgba(6,182,212,0.35);
      opacity:.55;
    }
    .breathWave.w2{ top:122px; width:66px; opacity:.45; }
    @keyframes wave{
      0%,100%{ transform:translateX(-50%) scaleX(0.85); opacity:.35; }
      50%{ transform:translateX(-50%) scaleX(1.18); opacity:.75; }
    }
    .breathWave.pulse{ animation:wave 1.1s infinite ease-in-out; }

    /* Spotlight slider tool */
    .sliderRig{
      width:190px; height:160px;
      position:relative;
    }
    .sliderTrack{
      position:absolute;
      left:50%; bottom:26px;
      transform:translateX(-50%);
      width:150px; height:18px;
      border-radius:999px;
      background:#E2E8F0;
      border:2px solid #CBD5E1;
      box-shadow:inset 0 6px 10px rgba(0,0,0,0.06);
    }
    .sliderKnob{
      position:absolute;
      top:50%;
      transform:translateY(-50%);
      width:30px; height:30px;
      border-radius:50%;
      background:linear-gradient(135deg,#A78BFA,#7C3AED);
      box-shadow:0 10px 14px rgba(0,0,0,0.12), inset 0 10px 14px rgba(255,255,255,0.25);
      transition:left .2s ease;
      left:8px;
    }
    .sliderKnob.small{ left:8px; }
    .sliderKnob.med{ left:60px; }
    .sliderKnob.big{ left:112px; }

    /* Teddy heart pop */
    .teddy{
      width:130px; height:118px;
      border-radius:34px;
      background:linear-gradient(135deg,#FFE4E6,#FB7185);
      box-shadow:inset 0 10px 16px rgba(255,255,255,0.35), inset 0 -10px 16px rgba(0,0,0,0.12);
      position:relative;
    }
    .teddy:before,.teddy:after{
      content:"";
      position:absolute;
      width:34px; height:34px;
      border-radius:50%;
      background:linear-gradient(135deg,#FFD1DC,#FB7185);
      top:18px;
      box-shadow:inset 0 8px 12px rgba(255,255,255,0.25);
    }
    .teddy:before{ left:-10px; }
    .teddy:after{ right:-10px; }
    .teddyFace{
      position:absolute;
      inset:0;
      display:flex;
      align-items:center;
      justify-content:center;
      flex-direction:column;
      gap:10px;
    }
    .tEyes{ display:flex; gap:14px; margin-top:24px; }
    .tEye{
      width:9px; height:9px;
      background:rgba(15,23,42,0.7);
      border-radius:50%;
    }
    .tSmile{
      width:34px; height:18px;
      border:4px solid rgba(15,23,42,0.48);
      border-top:0; border-left:0; border-right:0;
      border-radius:0 0 20px 20px;
      opacity:.9;
    }
    .heartPop{
      position:absolute;
      left:50%; top:12px;
      transform:translateX(-50%);
      width:18px; height:18px;
      background:#fff;
      border-radius:6px;
      clip-path:polygon(50% 85%, 95% 45%, 78% 18%, 50% 32%, 22% 18%, 5% 45%);
      opacity:0;
      pointer-events:none;
    }
    @keyframes heartBurst{
      0%{ transform:translateX(-50%) translateY(10px) scale(.2); opacity:0; }
      20%{ opacity:1; }
      100%{ transform:translateX(-50%) translateY(-18px) scale(1.6); opacity:0; }
    }
    .heartPop.burst{ animation:heartBurst .9s ease-out forwards; }

    /* Repair tape */
    .paperRig{
      width:170px; height:120px;
      position:relative;
    }
    .paperLeft, .paperRight{
      position:absolute;
      top:22px;
      width:74px; height:76px;
      border-radius:18px;
      background:linear-gradient(135deg,#FFFFFF,#F1F5F9);
      border:2px solid #E2E8F0;
      box-shadow:0 12px 16px rgba(0,0,0,0.08);
    }
    .paperLeft{ left:14px; transform:rotate(-3deg); }
    .paperRight{ right:14px; transform:rotate(3deg); }
    .tearGap{
      position:absolute;
      left:50%; top:22px;
      transform:translateX(-50%);
      width:20px; height:76px;
      background:linear-gradient(180deg,rgba(251,113,133,0.08),rgba(124,58,237,0.08));
      border-radius:12px;
      opacity:.9;
    }
    .tape{
      position:absolute;
      left:50%; top:54px;
      transform:translateX(-50%) rotate(-8deg);
      width:0px; height:22px;
      border-radius:10px;
      background:linear-gradient(135deg,#FDE68A,#F59E0B);
      box-shadow:0 12px 16px rgba(0,0,0,0.10);
      opacity:.95;
    }
    @keyframes tapeSlide{
      0%{ width:0; opacity:0; }
      20%{ opacity:1; }
      100%{ width:108px; opacity:1; }
    }
    .tape.on{ animation:tapeSlide .35s ease-out forwards; }

    /* Replay rewriter */
    .filmRig{
      width:190px; height:150px;
      position:relative;
    }
    .film{
      position:absolute;
      left:50%; top:22px;
      transform:translateX(-50%);
      width:160px; height:62px;
      border-radius:18px;
      background:linear-gradient(135deg,#1F2937,#0F172A);
      box-shadow:0 14px 18px rgba(0,0,0,0.18);
      overflow:hidden;
    }
    .film:before{
      content:"";
      position:absolute;
      inset:8px 10px;
      border-radius:12px;
      background:linear-gradient(135deg,rgba(251,113,133,0.18),rgba(124,58,237,0.18));
    }
    .perfs{
      position:absolute;
      left:10px; top:8px;
      width:12px; height:46px;
      display:flex;
      flex-direction:column;
      gap:6px;
    }
    .perf{
      width:12px; height:6px;
      border-radius:4px;
      background:rgba(226,232,240,0.35);
      opacity:.8;
    }
    .perfs.r{ left:auto; right:10px; }
    @keyframes filmJitter{
      0%,100%{ transform:translateX(-50%) translateY(0); }
      50%{ transform:translateX(-50%) translateY(-2px); }
    }
    .film.jitter{ animation:filmJitter .45s infinite ease-in-out; }

    .eraser{
      position:absolute;
      right:10px; top:92px;
      width:74px; height:36px;
      border-radius:18px;
      background:linear-gradient(135deg,#E2E8F0,#94A3B8);
      box-shadow:0 12px 16px rgba(0,0,0,0.12), inset 0 10px 14px rgba(255,255,255,0.25);
      transform:rotate(10deg);
      opacity:.95;
    }
    .eraser:after{
      content:"";
      position:absolute;
      left:10px; top:8px;
      width:22px; height:20px;
      border-radius:12px;
      background:rgba(251,113,133,0.22);
    }
    @keyframes eraseSweep{
      0%{ transform:translateX(0) rotate(10deg); opacity:0.9; }
      55%{ transform:translateX(-84px) rotate(-8deg); opacity:1; }
      100%{ transform:translateX(-74px) rotate(-4deg); opacity:0.9; }
    }
    .eraser.sweep{ animation:eraseSweep .55s ease-out forwards; }

    /* Exit + return */
    .curtainRig{
      width:190px; height:160px;
      position:relative;
    }
    .curtain{
      position:absolute;
      left:18px; top:22px;
      width:66px; height:118px;
      border-radius:18px;
      background:linear-gradient(135deg,#EDE9FE,#7C3AED);
      box-shadow:inset 0 10px 16px rgba(255,255,255,0.25), inset 0 -10px 16px rgba(0,0,0,0.12);
      opacity:.95;
    }
    .curtain:before{
      content:"";
      position:absolute;
      inset:10px 12px;
      border-radius:14px;
      background:linear-gradient(180deg,rgba(255,255,255,0.18),rgba(255,255,255,0));
    }
    @keyframes stepOutIn{
      0%,100%{ transform:translateY(4px) translateX(40px); opacity:1; }
      35%{ transform:translateY(4px) translateX(16px); opacity:1; }
      55%{ transform:translateY(4px) translateX(16px); opacity:1; }
      72%{ transform:translateY(4px) translateX(40px); opacity:1; }
    }
    .kid.exitLoop{ animation:stepOutIn 1.7s infinite ease-in-out; }

    /* Tools cards should not be blocked */
    .illus3d, .illus3d *{ pointer-events:none; }

    a{ pointer-events:auto; text-decoration:none; }
  </style>
</head>

<body>
  <div id="app-container"></div>

  <script>
    const container = document.getElementById('app-container');

    // ---- Clear timers safety (intervals/timeouts) ----
    const SafeTimers = (() => {
      const intervals = new Set();
      const timeouts  = new Set();
      function setI(fn, ms){ const id = setInterval(fn, ms); intervals.add(id); return id; }
      function setT(fn, ms){ const id = setTimeout(fn, ms); timeouts.add(id); return id; }
      function clearAll(){
        intervals.forEach(id => clearInterval(id));
        timeouts.forEach(id => clearTimeout(id));
        intervals.clear();
        timeouts.clear();
      }
      return { setI, setT, clearAll };
    })();

    function esc(s){
      return (s ?? "").toString()
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#39;");
    }

    function popEl(el){
      if(!el) return;
      el.classList.remove('popIt');
      void el.offsetWidth;
      el.classList.add('popIt');
    }

    // --- Illustration builders ---
    function kidBase(extraClass=""){
      return `
        <div class="kid ${extraClass}">
          <div class="head">
            <div class="hair"></div>
            <div class="face">
              <div class="brows">
                <div class="brow"></div><div class="brow r"></div>
              </div>
              <div class="eyes">
                <div class="eye"></div><div class="eye"></div>
              </div>
              <div class="blush l pulse"></div>
              <div class="blush r pulse"></div>
              <div class="mouth"></div>
            </div>
          </div>
          <div class="arm l"><div class="hand"></div></div>
          <div class="arm r"><div class="hand"></div></div>
          <div class="body"></div>
          <div class="pants"></div>
          <div class="leg l"></div><div class="leg r"></div>
        </div>
      `;
    }

    function illusSpotlight(levelClass="big", pulse=true){
      return `
        <div class="illus3d">
          <div class="spotRig">
            <div class="spotLight"></div>
            <div class="spotCone ${levelClass} ${pulse ? "pulse" : ""}" id="spotCone"></div>
            ${kidBase("wince")}
          </div>
        </div>
      `;
    }

    function illusBackpack(){
      return `
        <div class="illus3d">
          <div style="position:relative; width:210px; height:170px; display:flex; align-items:center; justify-content:center;">
            ${kidBase("")}
            <div style="
              position:absolute; left:126px; top:88px;
              width:58px; height:54px; border-radius:18px;
              background:linear-gradient(135deg,#22D3EE,#06B6D4);
              box-shadow:0 14px 16px rgba(0,0,0,0.12), inset 0 10px 14px rgba(255,255,255,0.28);
              transform:rotate(6deg);
            "></div>
            <div style="
              position:absolute; left:138px; top:78px;
              width:34px; height:22px; border-radius:14px;
              background:rgba(255,255,255,0.28);
              transform:rotate(6deg);
            "></div>
            <div style="
              position:absolute; right:18px; top:28px;
              width:22px; height:16px; border-radius:8px;
              background:linear-gradient(135deg,#FFE4E6,#FB7185);
              box-shadow:0 10px 12px rgba(0,0,0,0.10);
              opacity:.92;
              animation: floaty 2.0s infinite ease-in-out;
            "></div>
            <div style="
              position:absolute; right:44px; top:46px;
              width:22px; height:16px; border-radius:8px;
              background:linear-gradient(135deg,#EDE9FE,#7C3AED);
              box-shadow:0 10px 12px rgba(0,0,0,0.10);
              opacity:.92;
              animation: floaty 2.2s infinite ease-in-out;
            "></div>
            <div style="
              position:absolute; right:28px; top:66px;
              width:22px; height:16px; border-radius:8px;
              background:linear-gradient(135deg,#CFFAFE,#06B6D4);
              box-shadow:0 10px 12px rgba(0,0,0,0.10);
              opacity:.92;
              animation: floaty 2.4s infinite ease-in-out;
            "></div>
          </div>
        </div>
      `;
    }

    function illusHideFace(){
      return `<div class="illus3d">${kidBase("hideFace wince")}</div>`;
    }

    function illusNervousLaugh(){
      return `
        <div class="illus3d">
          <div style="position:relative; width:210px; height:170px; display:flex; align-items:center; justify-content:center;">
            ${kidBase("nervous")}
            <div class="talkBubble wiggle"></div>
          </div>
        </div>
      `;
    }

    function illusFreeze(){
      return `
        <div class="illus3d">
          <div style="position:relative; width:210px; height:170px; display:flex; align-items:center; justify-content:center;">
            ${kidBase("freeze")}
            <div class="iceSpark rise" style="left:44px; top:62px; animation-delay:.05s;"></div>
            <div class="iceSpark rise" style="left:62px; top:48px; animation-delay:.22s;"></div>
            <div class="iceSpark rise" style="right:60px; top:52px; animation-delay:.12s;"></div>
            <div class="iceSpark rise" style="right:44px; top:66px; animation-delay:.28s;"></div>
          </div>
        </div>
      `;
    }

    function illusDefensive(){
      return `
        <div class="illus3d">
          <div style="position:relative; width:210px; height:170px; display:flex; align-items:center; justify-content:center;">
            <div class="shield pop"></div>
            ${kidBase("defensive")}
          </div>
        </div>
      `;
    }

    function illusAvoidDoor(){
      return `
        <div class="illus3d">
          <div class="doorRig">
            <div class="doorEdge slide"></div>
            ${kidBase("stepBack")}
          </div>
        </div>
      `;
    }

    function illusMirrorScribble(){
      return `
        <div class="illus3d">
          <div class="mirrorRig">
            <div class="mirror"></div>
            <div class="scribble spin"></div>
            <div style="position:absolute; left:116px; top:12px; transform:scale(.92);">
              ${kidBase("wince")}
            </div>
          </div>
        </div>
      `;
    }

    function illusMissOut(){
      return `
        <div class="illus3d">
          <div class="missRig">
            <div class="playSign"></div>
            <div class="ball bob"></div>
            <div style="position:absolute; left:92px; top:12px; transform:scale(.92);">
              ${kidBase("wince")}
            </div>
          </div>
        </div>
      `;
    }

    // Tool illustrations
    function illusCoolCheeks(){
      return `
        <div class="illus3d">
          <div style="position:relative; width:210px; height:170px; display:flex; align-items:center; justify-content:center;">
            ${kidBase("wince")}
            <div class="coolPack"></div>
            <div class="breathWave pulse"></div>
            <div class="breathWave w2 pulse" style="animation-delay:.15s;"></div>
          </div>
        </div>
      `;
    }

    function illusSpotSlider(level="med"){
      return `
        <div class="illus3d">
          <div class="sliderRig">
            <div style="position:absolute; left:50%; top:10px; transform:translateX(-50%);">
              <div class="spotLight" style="width:62px; height:24px;"></div>
              <div class="spotCone ${level} pulse" id="tool2Cone" style="border-top-width:108px;"></div>
            </div>
            <div style="position:absolute; left:50%; top:44px; transform:translateX(-50%) scale(.82);">
              ${kidBase("wince")}
            </div>
            <div class="sliderTrack">
              <div class="sliderKnob ${level}" id="tool2Knob"></div>
            </div>
          </div>
        </div>
      `;
    }

    function illusTeddy(){
      return `
        <div class="illus3d" style="filter:drop-shadow(0 18px 18px rgba(0,0,0,0.16));">
          <div class="teddy">
            <div class="heartPop" id="heartPop"></div>
            <div class="teddyFace">
              <div class="tEyes"><div class="tEye"></div><div class="tEye"></div></div>
              <div class="tSmile"></div>
            </div>
          </div>
        </div>
      `;
    }

    function illusRepair(){
      return `
        <div class="illus3d">
          <div class="paperRig">
            <div class="paperLeft"></div>
            <div class="paperRight"></div>
            <div class="tearGap"></div>
            <div class="tape" id="tape"></div>
          </div>
        </div>
      `;
    }

    function illusReplay(){
      return `
        <div class="illus3d">
          <div class="filmRig">
            <div class="film jitter" id="film">
              <div class="perfs">
                <div class="perf"></div><div class="perf"></div><div class="perf"></div><div class="perf"></div><div class="perf"></div>
              </div>
              <div class="perfs r">
                <div class="perf"></div><div class="perf"></div><div class="perf"></div><div class="perf"></div><div class="perf"></div>
              </div>
            </div>
            <div class="eraser" id="eraser"></div>
          </div>
        </div>
      `;
    }

    function illusExit(){
      return `
        <div class="illus3d">
          <div class="curtainRig">
            <div class="curtain"></div>
            <div style="position:absolute; left:58px; top:12px; transform:scale(.92);">
              ${kidBase("exitLoop")}
            </div>
          </div>
        </div>
      `;
    }

    // ---- Screens ----
    function showHome(){
      SafeTimers.clearAll();
      container.innerHTML = `
        <h1 class="title">Understanding Embarrassed</h1>
        <p class="subtitle">Embarrassed is when something feels exposed, awkward, or “everyone noticed.”</p>
        <p class="support">It doesn’t mean you’re bad—it means your brain wants safety, a quick reset, and a simple next move.</p>

        <div class="grid-2">
          <div class="white-card" style="border-bottom-color:#FB7185;">
            ${illusSpotlight("big", true)}
            <div class="card-title">What’s happening?</div>
            <p class="card-desc">Your body can heat up fast, your thoughts race, and you want to shrink—because your brain thinks a spotlight is on you.</p>

            <div class="pillRow">
              <span class="pillTag">hot cheeks</span>
              <span class="pillTag">butterfly stomach</span>
              <span class="pillTag">tight throat</span>
              <span class="pillTag trig">made a mistake</span>
              <span class="pillTag trig">people looked</span>
              <span class="pillTag trig">said the wrong thing</span>
            </div>

            <button class="btn btn-rose" onclick="showReactions()">See Behaviors</button>
          </div>

          <div class="white-card clickable-card" id="toolsHomeCard" style="border-bottom-color:#7C3AED;">
            ${illusBackpack()}
            <div class="card-title">Tools</div>
            <p class="card-desc">Shrink the “spotlight,” calm the body, repair if needed, and move forward with a simple plan.</p>
            <button class="btn btn-violet" onclick="showSolutions()">Show Comfort Tools</button>
          </div>
        </div>

        <div style="text-align:center; margin-top:26px;">
          <a href="index.html" style="color:#94A3B8; font-weight:800;">← Back to Menu</a>
        </div>
      `;

      const toolsCard = document.getElementById('toolsHomeCard');
      if(toolsCard){
        toolsCard.addEventListener('click', (e) => {
          if(e.target && e.target.tagName === 'BUTTON') return;
          showSolutions();
        });
      }
    }

    function showReactions(){
      SafeTimers.clearAll();
      container.innerHTML = `
        <button class="btn-back" onclick="showHome()">← Back</button>
        <h1 class="title rose-title">How Do I Act When I’m Embarrassed?</h1>
        <p class="subtitle violet-title" style="font-weight:800;">These reactions are clues your brain wants safety.</p>

        <div class="grid-2">
          <div class="white-card" style="border-bottom-color:#FB7185;">
            ${illusHideFace()}
            <div class="card-title">I Hide My Face</div>
            <p class="card-desc">I cover up, look down, or want to disappear.</p>
          </div>

          <div class="white-card" style="border-bottom-color:#7C3AED;">
            ${illusNervousLaugh()}
            <div class="card-title">I Nervous Laugh</div>
            <p class="card-desc">I giggle or talk weird because I’m trying to escape the feeling.</p>
          </div>

          <div class="white-card" style="border-bottom-color:#06B6D4;">
            ${illusFreeze()}
            <div class="card-title">I Freeze</div>
            <p class="card-desc">My body goes stiff and I can’t think fast.</p>
          </div>

          <div class="white-card" style="border-bottom-color:#F59E0B;">
            ${illusDefensive()}
            <div class="card-title">I Get Defensive</div>
            <p class="card-desc">I get snappy, argue, or act like I don’t care (but I do).</p>
          </div>
        </div>

        <div class="white-card" style="margin-top:26px; border-bottom-color:#7C3AED;">
          <p style="font-weight:900; font-size:20px; color:#5B21B6; margin:0;">What can happen if embarrassment stays in charge?</p>
          <button class="btn btn-violet" style="width:auto; margin-top:14px;" onclick="showConsequences()">See Consequences ➔</button>
        </div>

        <div style="text-align:center; margin-top:26px;">
          <a href="index.html" style="color:#94A3B8; font-weight:800;">← Back to Menu</a>
        </div>
      `;
    }

    function showConsequences(){
      SafeTimers.clearAll();
      container.innerHTML = `
        <button class="btn-back" onclick="showReactions()">← Back</button>
        <h1 class="title rose-title">When Embarrassed Takes Over…</h1>
        <p class="subtitle">It can push you away from people and practice—even when you’re still learning.</p>

        <div class="grid-2">
          <div class="white-card" style="border-bottom-color:#7C3AED;">
            ${illusAvoidDoor()}
            <div class="card-title">I Avoid People</div>
            <p class="card-desc">I want to leave, hide, or skip things next time.</p>
          </div>

          <div class="white-card" style="border-bottom-color:#FB7185;">
            ${illusSpotlight("big", true)}
            <div class="card-title">The Spotlight Feels Huge</div>
            <p class="card-desc">My brain acts like everyone is watching (even if they aren’t).</p>
          </div>

          <div class="white-card" style="border-bottom-color:#06B6D4;">
            ${illusMirrorScribble()}
            <div class="card-title">I Beat Myself Up</div>
            <p class="card-desc">I replay the moment and feel worse.</p>
          </div>

          <div class="white-card" style="border-bottom-color:#F59E0B;">
            ${illusMissOut()}
            <div class="card-title">I Miss Out</div>
            <p class="card-desc">I stop trying—and practice is how confidence grows.</p>
          </div>
        </div>

        <div class="white-card" style="margin-top:26px; border-bottom-color:#22C55E;">
          <p style="font-weight:900; font-size:20px; color:#166534; margin:0;">Good news: you can reset, repair, and return.</p>
          <button class="btn btn-cyan" style="width:auto; margin-top:14px;" onclick="showSolutions()">Go to Comfort Tools ➔</button>
        </div>

        <div style="text-align:center; margin-top:26px;">
          <a href="index.html" style="color:#94A3B8; font-weight:800;">← Back to Menu</a>
        </div>
      `;
    }

    // ---- Tool states ----
    let t1Interval = null;
    let t1Running = false;
    let t1Remain = 30;

    let tool2Level = "med"; // small / med / big
    const tool2Order = ["big","med","small"];

    const kindLines = [
      "Everyone makes awkward moments. That’s how brains learn.",
      "I can feel embarrassed and still be safe.",
      "One moment does not define me.",
      "I can repair this with one calm sentence.",
      "Practice makes confidence—one try at a time."
    ];
    let kindIdx = 0;

    let t6Interval = null;
    let t6Running = false;
    let t6Remain = 60;

    function resetToolStates(){
      t1Running = false; t1Remain = 30;
      if(t1Interval){ clearInterval(t1Interval); t1Interval = null; }

      tool2Level = "med";

      kindIdx = 0;

      t6Running = false; t6Remain = 60;
      if(t6Interval){ clearInterval(t6Interval); t6Interval = null; }
    }

    function showSolutions(){
      SafeTimers.clearAll();
      container.innerHTML = `
        <button class="btn-back" onclick="showHome()">← Back to Start</button>
        <h1 class="title rose-title">Comfort Tools</h1>
        <p class="subtitle">Embarrassment gets smaller when your body calms and your plan gets simple.</p>

        <div class="toolsStack">

          <!-- TOOL 1 -->
          <div class="white-card" style="border-bottom-color:#06B6D4;">
            ${illusCoolCheeks()}
            <div class="card-title cyan-title">Cool Cheeks Reset (30s)</div>
            <p class="card-desc">Why it helps: cooling + slow breathing tells your nervous system, “I’m safe.”</p>

            <div class="mini-panel">
              <div class="phasePill" id="t1Status">Ready</div>
              <div class="timerBig" id="t1Time">30</div>
              <div class="progressBar">
                <div class="progressFill" id="t1Fill"></div>
              </div>
              <div class="tinyNote" id="t1Hint">Breathe out slowly. Let your shoulders drop.</div>
            </div>

            <div class="toolBtnRow">
              <button class="btn btn-cyan" id="t1Start">Start</button>
              <button class="btn btn-violet" id="t1Pause">Pause</button>
              <button class="btn btn-amber" id="t1Reset">Reset</button>
            </div>
          </div>

          <!-- TOOL 2 -->
          <div class="white-card" style="border-bottom-color:#7C3AED;">
            ${illusSpotSlider("med")}
            <div class="card-title violet-title">Spotlight Shrinker (Reality Check)</div>
            <p class="card-desc">Why it helps: embarrassment makes your brain overestimate attention. Shrinking the spotlight helps your thinking return.</p>

            <div class="mini-panel">
              <div class="phasePill" id="spotLevelPill">Spotlight: Medium</div>
              <div style="font-weight:900; font-size:18px; margin-top:10px;" id="spotLine">Most people are busy with their own thoughts.</div>
              <div class="tinyNote">Try: “This is a small moment. I can keep going.”</div>
            </div>

            <div class="toolBtnRow">
              <button class="btn btn-violet" id="spotShrink">Shrink Spotlight</button>
              <button class="btn btn-slate" id="spotReset">Reset</button>
            </div>
          </div>

          <!-- TOOL 3 -->
          <div class="white-card" style="border-bottom-color:#FB7185;">
            ${illusTeddy()}
            <div class="card-title rose-title">Kind Inner Coach (Self-Compassion Line)</div>
            <p class="card-desc">Why it helps: self-kindness lowers shame and helps you rejoin the moment.</p>

            <div class="mini-panel">
              <div class="phasePill">Coach Line</div>
              <div style="font-weight:900; font-size:18px; margin-top:10px;" id="kindLine">${esc(kindLines[0])}</div>
            </div>

            <div class="toolBtnRow">
              <button class="btn btn-rose" id="kindNext">Next Line</button>
              <button class="btn btn-slate" id="kindReplay">Replay Heart</button>
            </div>
          </div>

          <!-- TOOL 4 -->
          <div class="white-card" style="border-bottom-color:#F59E0B;">
            ${illusRepair()}
            <div class="card-title amber-title">Repair Script (Fix-It Plan)</div>
            <p class="card-desc">Why it helps: a simple repair sentence rebuilds confidence and connection.</p>

            <div class="split2">
              <div class="mini-panel" style="text-align:left;">
                <div class="label">Who are you talking to?</div>
                <select id="repairWho">
                  <option value="">Choose one…</option>
                  <option>Teacher</option>
                  <option>Friend</option>
                  <option>Coach</option>
                  <option>Parent</option>
                  <option>Someone nearby</option>
                </select>
                <div class="tinyNote" style="margin-top:10px;">Or type a name:</div>
                <input type="text" id="repairWhoCustom" placeholder="Example: Ms. Rivera" />
              </div>

              <div class="mini-panel" style="text-align:left;">
                <div class="label">What happened?</div>
                <input type="text" id="repairWhat" placeholder="Example: I answered wrong / I spilled / I said it weird" />
                <div class="label" style="margin-top:10px;">What fix do you want?</div>
                <select id="repairFix">
                  <option value="">Choose one…</option>
                  <option>try again</option>
                  <option>get a quick reset</option>
                  <option>clean it up</option>
                  <option>start over</option>
                  <option>move on</option>
                </select>
              </div>
            </div>

            <div class="toolBtnRow">
              <button class="btn btn-amber" id="repairBuild">Build Repair</button>
              <button class="btn btn-slate" id="repairClear">Clear</button>
            </div>

            <div class="mini-panel" id="repairOut" style="font-weight:900; font-size:18px;">
              Hi ____. I feel embarrassed because ____. Can I ____?
            </div>
          </div>

          <!-- TOOL 5 -->
          <div class="white-card" style="border-bottom-color:#06B6D4;">
            ${illusReplay()}
            <div class="card-title cyan-title">Replay Rewriter (New Story Button)</div>
            <p class="card-desc">Why it helps: replaying keeps shame loud. A new story turns it into learning.</p>

            <div class="field">
              <label class="label" for="replayText">What moment is your brain replaying?</label>
              <input type="text" id="replayText" placeholder="Example: everyone looked at me / I said it wrong" />
            </div>

            <div class="toolBtnRow">
              <button class="btn btn-cyan" id="rewriteBtn">Rewrite</button>
              <button class="btn btn-slate" id="rewriteClear">Clear</button>
            </div>

            <div class="split2" id="rewriteOut" style="display:none;">
              <div class="miniBox">
                <h4>New story</h4>
                <p id="newStory"></p>
              </div>
              <div class="miniBox">
                <h4>Next move</h4>
                <p id="nextMove"></p>
              </div>
            </div>
          </div>

          <!-- TOOL 6 -->
          <div class="white-card" style="border-bottom-color:#7C3AED;">
            ${illusExit()}
            <div class="card-title violet-title">Quick Exit + Return Plan</div>
            <p class="card-desc">Why it helps: a short “step away” prevents panic and helps you rejoin with confidence.</p>

            <div class="split2">
              <div class="mini-panel" style="text-align:left;">
                <div class="label">Where can you step away?</div>
                <select id="exitWhere">
                  <option value="">Choose one…</option>
                  <option>get water</option>
                  <option>bathroom break</option>
                  <option>quiet corner</option>
                  <option>ask to step outside</option>
                  <option>stand near the wall</option>
                </select>
              </div>
              <div class="mini-panel" style="text-align:left;">
                <div class="label">How long?</div>
                <select id="exitTime">
                  <option value="30">30 seconds</option>
                  <option value="60" selected>60 seconds</option>
                  <option value="120">2 minutes</option>
                </select>
                <div class="tinyNote">Short is better. You’re not escaping—just resetting.</div>
              </div>
            </div>

            <div class="mini-panel">
              <div class="phasePill" id="t6Status">Ready</div>
              <div class="timerBig" id="t6Time">60</div>
              <div class="progressBar">
                <div class="progressFill" id="t6Fill" style="background:linear-gradient(135deg,#7C3AED,#06B6D4)"></div>
              </div>
              <div class="tinyNote" id="t6Hint">Step away, breathe out slowly, then return with one simple sentence.</div>
            </div>

            <div class="toolBtnRow">
              <button class="btn btn-violet" id="t6Start">Start</button>
              <button class="btn btn-slate" id="t6Pause">Pause</button>
              <button class="btn btn-amber" id="t6Reset">Reset</button>
              <button class="btn btn-cyan" id="t6Plan">Build Plan</button>
            </div>

            <div class="mini-panel" id="t6Out" style="display:none; font-weight:900; font-size:18px;"></div>
          </div>

        </div>

        <div style="text-align:center; margin-top:26px;">
          <a href="index.html" style="color:#94A3B8; font-weight:800;">← Back to Menu</a>
        </div>
      `;

      resetToolStates();
      bindTools();
    }

    function bindTools(){
      // TOOL 1: 30s timer
      const t1Status = document.getElementById('t1Status');
      const t1Time   = document.getElementById('t1Time');
      const t1Fill   = document.getElementById('t1Fill');
      const t1Hint   = document.getElementById('t1Hint');
      const bStart   = document.getElementById('t1Start');
      const bPause   = document.getElementById('t1Pause');
      const bReset   = document.getElementById('t1Reset');

      function t1Update(){
        if(!t1Time || !t1Fill || !t1Status) return;
        t1Time.textContent = String(t1Remain);
        const done = 30 - t1Remain;
        t1Fill.style.width = ((done/30)*100).toFixed(2) + "%";
        if(t1Remain === 30 && !t1Running) t1Status.textContent = "Ready";
        else if(t1Running) t1Status.textContent = "Running";
        else t1Status.textContent = "Paused";
      }
      function t1Finish(){
        t1Running = false;
        if(t1Interval){ clearInterval(t1Interval); t1Interval = null; }
        if(t1Status) t1Status.textContent = "Done";
        if(t1Hint) t1Hint.textContent = "Nice. The heat can cool down. Now choose a simple next move.";
        if(t1Fill) t1Fill.style.width = "100%";
      }

      if(bStart){
        bStart.addEventListener('click', () => {
          popEl(bStart);
          if(t1Running) return;
          if(t1Remain === 0) t1Remain = 30;
          t1Running = true;
          if(t1Hint) t1Hint.textContent = "Breathe out slowly. Let your jaw unclench.";
          t1Update();
          if(!t1Interval){
            t1Interval = SafeTimers.setI(() => {
              if(!t1Running) return;
              t1Remain--;
              if(t1Remain <= 0){
                t1Remain = 0;
                t1Update();
                t1Finish();
              } else t1Update();
            }, 1000);
          }
        });
      }
      if(bPause){
        bPause.addEventListener('click', () => {
          popEl(bPause);
          if(!t1Running){
            if(t1Hint) t1Hint.textContent = "Paused is okay. Start when you’re ready.";
            return;
          }
          t1Running = false;
          t1Update();
          if(t1Hint) t1Hint.textContent = "Pause. Drop your shoulders.";
        });
      }
      if(bReset){
        bReset.addEventListener('click', () => {
          popEl(bReset);
          t1Running = false;
          t1Remain = 30;
          if(t1Hint) t1Hint.textContent = "Breathe out slowly. Let your shoulders drop.";
          t1Update();
        });
      }
      t1Update();

      // TOOL 2: Spotlight shrinker
      const spotPill = document.getElementById('spotLevelPill');
      const spotLine = document.getElementById('spotLine');
      const spotShrink = document.getElementById('spotShrink');
      const spotReset  = document.getElementById('spotReset');
      const cone = document.getElementById('tool2Cone');
      const knob = document.getElementById('tool2Knob');

      function applySpot(){
        if(cone){
          cone.classList.remove('small','med','big');
          cone.classList.add(tool2Level);
        }
        if(knob){
          knob.classList.remove('small','med','big');
          knob.classList.add(tool2Level);
        }
        if(spotPill){
          spotPill.textContent =
            tool2Level === "big" ? "Spotlight: Big" :
            tool2Level === "small" ? "Spotlight: Small" : "Spotlight: Medium";
        }
        if(spotLine){
          spotLine.textContent =
            tool2Level === "big" ? "My brain is shouting “everyone saw!”" :
            tool2Level === "med" ? "This feels big, but it’s usually smaller than it seems." :
            "Most people forget quickly. I can keep going.";
        }
      }

      if(spotShrink){
        spotShrink.addEventListener('click', () => {
          popEl(spotShrink);
          const i = tool2Order.indexOf(tool2Level);
          tool2Level = tool2Order[Math.min(tool2Order.length-1, i+1)];
          applySpot();
        });
      }
      if(spotReset){
        spotReset.addEventListener('click', () => {
          popEl(spotReset);
          tool2Level = "med";
          applySpot();
        });
      }
      applySpot();

      // TOOL 3: Kind coach + heart pop
      const kindLine = document.getElementById('kindLine');
      const kindNext = document.getElementById('kindNext');
      const kindReplay = document.getElementById('kindReplay');
      const heart = document.getElementById('heartPop');

      function doHeart(){
        if(!heart) return;
        heart.classList.remove('burst');
        void heart.offsetWidth;
        heart.classList.add('burst');
      }

      if(kindNext){
        kindNext.addEventListener('click', () => {
          popEl(kindNext);
          kindIdx = (kindIdx + 1) % kindLines.length;
          if(kindLine) kindLine.textContent = kindLines[kindIdx];
          doHeart();
        });
      }
      if(kindReplay){
        kindReplay.addEventListener('click', () => {
          popEl(kindReplay);
          doHeart();
        });
      }

      // TOOL 4: Repair builder + tape animation
      const repairWho = document.getElementById('repairWho');
      const repairWhoCustom = document.getElementById('repairWhoCustom');
      const repairWhat = document.getElementById('repairWhat');
      const repairFix = document.getElementById('repairFix');
      const repairBuild = document.getElementById('repairBuild');
      const repairClear = document.getElementById('repairClear');
      const repairOut = document.getElementById('repairOut');
      const tape = document.getElementById('tape');

      function getWho(){
        const c = (repairWhoCustom?.value || "").trim();
        return c || (repairWho?.value || "") || "____";
      }
      function getFix(){
        const f = (repairFix?.value || "").trim();
        return f || "____";
      }
      function getWhat(){
        const w = (repairWhat?.value || "").trim();
        return w || "____";
      }

      function playTape(){
        if(!tape) return;
        tape.classList.remove('on');
        void tape.offsetWidth;
        tape.classList.add('on');
      }

      if(repairBuild){
        repairBuild.addEventListener('click', () => {
          popEl(repairBuild);
          playTape();
          const who = esc(getWho());
          const what = esc(getWhat());
          const fix = esc(getFix());
          if(repairOut){
            repairOut.textContent = `Hi ${who}. I feel embarrassed because ${what}. Can I ${fix}?`;
          }
        });
      }
      if(repairClear){
        repairClear.addEventListener('click', () => {
          popEl(repairClear);
          if(repairWho) repairWho.value = "";
          if(repairWhoCustom) repairWhoCustom.value = "";
          if(repairWhat) repairWhat.value = "";
          if(repairFix) repairFix.value = "";
          if(repairOut) repairOut.textContent = "Hi ____. I feel embarrassed because ____. Can I ____?";
        });
      }

      // TOOL 5: Replay rewriter + eraser sweep
      const replayText = document.getElementById('replayText');
      const rewriteBtn = document.getElementById('rewriteBtn');
      const rewriteClear = document.getElementById('rewriteClear');
      const rewriteOut = document.getElementById('rewriteOut');
      const newStory = document.getElementById('newStory');
      const nextMove = document.getElementById('nextMove');
      const eraser = document.getElementById('eraser');
      const film = document.getElementById('film');

      function makeRewrite(raw){
        const t = (raw || "").trim();
        const moment = t ? `"${t}"` : "that moment";
        return {
          story: `That was a learning moment, not an identity. I can be brave even after ${moment}.`,
          move: `Take one calm breath, lift your chin, and do the next small step (or use a repair sentence).`
        };
      }
      function sweep(){
        if(eraser){
          eraser.classList.remove('sweep');
          void eraser.offsetWidth;
          eraser.classList.add('sweep');
        }
        if(film){
          film.classList.remove('jitter');
          void film.offsetWidth;
          SafeTimers.setT(() => film.classList.add('jitter'), 50);
          SafeTimers.setT(() => film.classList.remove('jitter'), 520);
        }
      }

      if(rewriteBtn){
        rewriteBtn.addEventListener('click', () => {
          popEl(rewriteBtn);
          sweep();
          const plan = makeRewrite(replayText ? replayText.value : "");
          if(newStory) newStory.textContent = plan.story;
          if(nextMove) nextMove.textContent = plan.move;
          if(rewriteOut) rewriteOut.style.display = "grid";
        });
      }
      if(rewriteClear){
        rewriteClear.addEventListener('click', () => {
          popEl(rewriteClear);
          if(replayText) replayText.value = "";
          if(rewriteOut) rewriteOut.style.display = "none";
        });
      }

      // TOOL 6: Exit + return timer + plan
      const exitWhere = document.getElementById('exitWhere');
      const exitTime = document.getElementById('exitTime');

      const t6Status = document.getElementById('t6Status');
      const t6Time = document.getElementById('t6Time');
      const t6Fill = document.getElementById('t6Fill');
      const t6Hint = document.getElementById('t6Hint');
      const t6Start = document.getElementById('t6Start');
      const t6Pause = document.getElementById('t6Pause');
      const t6Reset = document.getElementById('t6Reset');
      const t6Plan = document.getElementById('t6Plan');
      const t6Out = document.getElementById('t6Out');

      function setT6FromSelect(){
        const val = parseInt(exitTime?.value || "60", 10);
        t6Remain = isNaN(val) ? 60 : val;
      }
      function t6Update(){
        if(!t6Time || !t6Fill || !t6Status) return;
        t6Time.textContent = String(t6Remain);
        const total = parseInt(exitTime?.value || "60", 10) || 60;
        const done = total - t6Remain;
        t6Fill.style.width = ((done/total)*100).toFixed(2) + "%";
        if(t6Remain === total && !t6Running) t6Status.textContent = "Ready";
        else if(t6Running) t6Status.textContent = "Running";
        else t6Status.textContent = "Paused";
      }
      function t6Finish(){
        t6Running = false;
        if(t6Interval){ clearInterval(t6Interval); t6Interval = null; }
        if(t6Status) t6Status.textContent = "Done";
        if(t6Hint) t6Hint.textContent = "Return with one simple sentence: “I’m okay. I’m back.”";
        if(t6Fill) t6Fill.style.width = "100%";
      }

      if(exitTime){
        exitTime.addEventListener('change', () => {
          setT6FromSelect();
          t6Running = false;
          if(t6Interval){ clearInterval(t6Interval); t6Interval = null; }
          t6Update();
        });
      }

      if(t6Start){
        t6Start.addEventListener('click', () => {
          popEl(t6Start);
          if(t6Running) return;
          const total = parseInt(exitTime?.value || "60", 10) || 60;
          if(t6Remain <= 0 || t6Remain > total) t6Remain = total;
          t6Running = true;
          if(t6Hint) t6Hint.textContent = "Step away. Breathe out slowly. Shoulders down.";
          t6Update();
          if(!t6Interval){
            t6Interval = SafeTimers.setI(() => {
              if(!t6Running) return;
              t6Remain--;
              if(t6Remain <= 0){
                t6Remain = 0;
                t6Update();
                t6Finish();
              } else t6Update();
            }, 1000);
          }
        });
      }

      if(t6Pause){
        t6Pause.addEventListener('click', () => {
          popEl(t6Pause);
          if(!t6Running){
            if(t6Hint) t6Hint.textContent = "Paused is okay. Keep your breathing slow.";
            return;
          }
          t6Running = false;
          t6Update();
          if(t6Hint) t6Hint.textContent = "Pause. Unclench your hands.";
        });
      }

      if(t6Reset){
        t6Reset.addEventListener('click', () => {
          popEl(t6Reset);
          t6Running = false;
          if(t6Interval){ clearInterval(t6Interval); t6Interval = null; }
          setT6FromSelect();
          if(t6Hint) t6Hint.textContent = "Step away, breathe out slowly, then return with one simple sentence.";
          t6Update();
        });
      }

      if(t6Plan){
        t6Plan.addEventListener('click', () => {
          popEl(t6Plan);
          const where = (exitWhere?.value || "").trim() || "a quick reset spot";
          const total = parseInt(exitTime?.value || "60", 10) || 60;
          const plan = [
            `1) Step to ${where}.`,
            `2) Breathe out slowly 3 times.`,
            `3) Say in your head: “Small moment. I’m safe.”`,
            `4) Return after ${total} seconds and do one tiny next step.`
          ].join("<br>");
          if(t6Out){
            t6Out.style.display = "block";
            t6Out.innerHTML = plan;
          }
        });
      }

      setT6FromSelect();
      t6Update();
    }

    // Expose navigation functions (standard)
    window.showHome = showHome;
    window.showReactions = showReactions;
    window.showConsequences = showConsequences;
    window.showSolutions = showSolutions;

    showHome();
  </script>
</body>
</html>
