<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Understanding Overwhelmed</title>

  <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600;700;800&display=swap" rel="stylesheet">

  <style>
    body {
      margin: 0; padding: 0;
      background:
        radial-gradient(#bae6fd 2px, transparent 2px),
        linear-gradient(180deg, #F4FAFF, #EEF7FF);
      background-size: 30px 30px, auto;
      font-family: 'Fredoka', sans-serif;
      color: #1F2937;
      display: flex; justify-content: center;
      min-height: 100vh;
      overflow-x: hidden;
    }
    #app-container {
      width: 100%;
      max-width: 860px;
      padding: 44px 18px;
      position: relative;
    }

    .white-card {
      background: white;
      border-radius: 26px;
      padding: 30px;
      box-shadow: 0 10px 26px rgba(0,0,0,0.06);
      text-align: center;
      margin-bottom: 24px;
      border-bottom: 7px solid #E5E7EB;
      position: relative;
      overflow: visible;
      transition: transform .18s ease;
    }
    .white-card:hover { transform: translateY(-4px); }

    .title {
      font-size: 40px;
      font-weight: 800;
      text-align: center;
      margin: 0 0 8px 0;
      letter-spacing: .2px;
      color: #0F172A;
    }
    .subtitle {
      text-align: center;
      color: #64748B;
      margin: 0 0 10px 0;
      font-size: 18px;
      line-height: 1.45;
    }
    .support {
      text-align: center;
      color: #0F172A;
      margin: 0 0 34px 0;
      font-size: 16px;
      line-height: 1.45;
      font-weight: 800;
      opacity: .86;
    }

    /* Theme accents for Overwhelmed */
    .accent-title { color: #0EA5E9; }    /* sky */
    .accent-sub   { color: #4338CA; }    /* indigo */

    .card-title {
      font-size: 22px;
      font-weight: 800;
      margin: 12px 0 6px 0;
      color: #0F172A;
    }
    .card-desc {
      font-size: 16px;
      color: #64748B;
      line-height: 1.55;
      margin: 0;
    }

    .btn {
      padding: 14px 22px;
      border-radius: 16px;
      font-weight: 800;
      font-size: 18px;
      border: none;
      cursor: pointer;
      color: white;
      transition: transform .2s ease, filter .2s ease;
      width: 100%;
      margin-top: 16px;
      box-shadow: 0 7px 16px rgba(0,0,0,0.12);
    }
    .btn:hover { transform: scale(1.02); filter: brightness(1.06); }
    .btn:disabled { opacity: .75; cursor: not-allowed; transform: none; }

    .btn-sky    { background: linear-gradient(135deg, #38BDF8, #0EA5E9); }
    .btn-indigo { background: linear-gradient(135deg, #6366F1, #4338CA); }
    .btn-green  { background: linear-gradient(135deg, #22C55E, #16A34A); }
    .btn-amber  { background: linear-gradient(135deg, #FBBF24, #D97706); }
    .btn-slate  { background: linear-gradient(135deg, #94A3B8, #475569); }

    .btn-back {
      background: white;
      border: 2px solid #CBD5E1;
      color: #334155;
      padding: 9px 16px;
      border-radius: 14px;
      font-weight: 800;
      cursor: pointer;
      margin-bottom: 18px;
    }

    .grid-2 {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 22px;
    }
    @media (max-width: 650px) { .grid-2 { grid-template-columns: 1fr; } }

    /* Emoji Scenes (no external images) */
    .emoji-scene, .emoji-scene * { pointer-events: none; } /* never block clicks */
    .emoji-scene {
      width: 210px;
      height: 170px;
      margin: 0 auto 6px auto;
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
      filter: drop-shadow(0 18px 18px rgba(0,0,0,0.16));
      user-select: none;
    }
    .emoji-main {
      font-size: 124px;
      line-height: 1;
    }
    .emoji-mini {
      position: absolute;
      font-size: 34px;
      opacity: .95;
      filter: drop-shadow(0 10px 12px rgba(0,0,0,0.14));
    }
    .m1 { left: 14px; bottom: 22px; transform: rotate(-10deg); }
    .m2 { right: 16px; top: 18px; transform: rotate(12deg); }
    .m3 { right: 18px; bottom: 24px; transform: rotate(-8deg); }

    /* General animations */
    @keyframes floaty { 0%,100%{ transform: translateY(0) scale(1); } 50%{ transform: translateY(-14px) scale(1.05); } }
    @keyframes wobble { 0%{ transform: rotate(0deg) } 25%{ transform: rotate(6deg) } 50%{ transform: rotate(0deg) } 75%{ transform: rotate(-6deg) } 100%{ transform: rotate(0deg) } }
    @keyframes boing  { 0%,100%{ transform: scale(1) } 50%{ transform: scale(1.18) } }
    @keyframes glow   { 0%,100%{ filter: drop-shadow(0 18px 18px rgba(0,0,0,0.16)) } 50%{ filter: drop-shadow(0 0 26px rgba(14,165,233,.55)) } }

    .floaty { animation: floaty 2.6s infinite ease-in-out; }
    .wobble { animation: wobble 0.9s infinite ease-in-out; }
    .boing  { animation: boing 1.1s infinite ease-in-out; }
    .glow   { animation: glow 1.6s infinite ease-in-out; }

    .bubble {
      display: none;
      background: #E0F2FE;
      border: 2px solid #BAE6FD;
      color: #075985;
      padding: 14px 14px;
      border-radius: 18px;
      font-weight: 800;
      margin-top: 12px;
      line-height: 1.45;
    }

    /* Pills (home signals/triggers + tool phase) */
    .pillRow {
      margin-top: 12px;
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      justify-content: center;
    }
    .pillTag {
      display: inline-block;
      padding: 6px 12px;
      border-radius: 999px;
      font-weight: 800;
      font-size: 13px;
      background: #E0F2FE;
      color: #075985;
      border: 2px solid #BAE6FD;
    }
    .pillTag.trig {
      background: #EEF2FF;
      border-color: #C7D2FE;
      color: #3730A3;
    }

    .mini-panel {
      background: #F8FAFC;
      border: 2px dashed #CBD5E1;
      border-radius: 18px;
      padding: 14px;
      margin-top: 12px;
      text-align: center;
      line-height: 1.45;
    }

    /* Tool layouts */
    .toolsStack { display:flex; flex-direction:column; gap:26px; margin-top:18px; }

    /* Timer + progress */
    .timerBig {
      font-size: 34px;
      font-weight: 900;
      margin-top: 10px;
      color: #0F172A;
      min-height: 44px;
    }
    .progressBar {
      width: 100%;
      height: 12px;
      background: #E2E8F0;
      border-radius: 999px;
      overflow: hidden;
      margin-top: 10px;
      border: 2px solid #CBD5E1;
    }
    .progressFill {
      width: 0%;
      height: 100%;
      background: linear-gradient(135deg, #38BDF8, #6366F1);
      border-radius: 999px;
      transition: width .18s ease;
    }
    .toolBtnRow {
      display: flex;
      gap: 10px;
      justify-content: center;
      flex-wrap: wrap;
      margin-top: 14px;
    }
    .toolBtnRow .btn {
      width: auto;
      margin-top: 0;
      padding: 12px 16px;
      font-size: 16px;
      border-radius: 14px;
    }

    /* Inputs */
    .field {
      text-align: left;
      margin-top: 12px;
    }
    .label {
      font-weight: 900;
      color: #0F172A;
      margin-bottom: 6px;
      display: block;
    }
    input[type="text"], textarea, select {
      width: 100%;
      border-radius: 16px;
      border: 2px solid #CBD5E1;
      padding: 12px 12px;
      font-family: inherit;
      font-weight: 800;
      color: #0F172A;
      outline: none;
      background: #FFFFFF;
      box-shadow: inset 0 1px 0 rgba(255,255,255,0.7);
    }
    textarea { min-height: 92px; resize: vertical; }

    .split3 {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 14px;
      margin-top: 12px;
      text-align: left;
    }
    @media (max-width: 650px) { .split3 { grid-template-columns: 1fr; } }
    .miniBox {
      background: #FFFFFF;
      border: 2px solid #E2E8F0;
      border-radius: 18px;
      padding: 12px;
      box-shadow: 0 8px 18px rgba(0,0,0,0.06);
    }
    .miniBox h4 {
      margin: 0 0 8px 0;
      font-size: 14px;
      font-weight: 900;
      color: #0F172A;
    }
    .miniBox p {
      margin: 0;
      font-weight: 800;
      color: #475569;
      line-height: 1.4;
      white-space: pre-wrap;
    }

    /* Grounding step */
    .phasePill {
      display: inline-block;
      padding: 6px 12px;
      border-radius: 999px;
      font-weight: 900;
      font-size: 13px;
      background: #EEF2FF;
      color: #3730A3;
      border: 2px solid #C7D2FE;
    }

    /* Task chips */
    .chipWrap {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      justify-content: center;
      margin-top: 10px;
    }
    .chip {
      padding: 8px 12px;
      border-radius: 999px;
      border: 2px solid #CBD5E1;
      background: #FFFFFF;
      font-weight: 900;
      cursor: pointer;
      user-select: none;
      transition: transform .15s ease, filter .15s ease, background .15s ease, border-color .15s ease;
    }
    .chip:hover { transform: scale(1.02); filter: brightness(1.02); }
    .chip.on {
      background: #DCFCE7;
      border-color: #86EFAC;
      color: #166534;
    }
    .warn {
      display: none;
      margin-top: 10px;
      padding: 10px 12px;
      border-radius: 16px;
      background: #FEF3C7;
      border: 2px solid #FDE68A;
      color: #92400E;
      font-weight: 900;
      line-height: 1.35;
    }
    .warn.show { display: block; }

    /* Copy feedback */
    .tinyNote {
      margin-top: 10px;
      color: #64748B;
      font-weight: 800;
      font-size: 13px;
      line-height: 1.35;
    }

    /* Clickable whole card for Tools on home (matches your earlier standard) */
    .clickable-card { cursor: pointer; }
  </style>
</head>

<body>
  <div id="app-container"></div>

  <script>
    const container = document.getElementById('app-container');

    // ---- Clear timers safety (intervals/timeouts) ----
    const SafeTimers = (() => {
      const intervals = new Set();
      const timeouts  = new Set();
      function setI(fn, ms){ const id = setInterval(fn, ms); intervals.add(id); return id; }
      function setT(fn, ms){ const id = setTimeout(fn, ms); timeouts.add(id); return id; }
      function clearAll(){
        intervals.forEach(id => clearInterval(id));
        timeouts.forEach(id => clearTimeout(id));
        intervals.clear();
        timeouts.clear();
      }
      return { setI, setT, clearAll };
    })();

    function emojiScene(main, minis = ["", "", ""], animClass = "floaty") {
      const [a,b,c] = minis;
      return `
        <div class="emoji-scene ${animClass}">
          <div class="emoji-main">${main}</div>
          ${a ? `<div class="emoji-mini m1">${a}</div>` : ``}
          ${b ? `<div class="emoji-mini m2">${b}</div>` : ``}
          ${c ? `<div class="emoji-mini m3">${c}</div>` : ``}
        </div>
      `;
    }

    // ---- Screen navigation ----
    function showHome(){
      SafeTimers.clearAll();
      container.innerHTML = `
        <h1 class="title">Understanding Overwhelmed</h1>
        <p class="subtitle">Overwhelmed is when too much happens at once and your brain says, ‚ÄúI can‚Äôt handle it!‚Äù</p>
        <p class="support">It doesn‚Äôt mean you‚Äôre weak‚Äîit means your brain needs smaller steps and a reset.</p>

        <div class="grid-2">
          <div class="white-card" style="border-bottom-color:#0EA5E9;">
            ${emojiScene("ü§Ø", ["üìö","‚è∞","üîî"], "floaty glow")}
            <div class="card-title">What‚Äôs happening?</div>
            <p class="card-desc">When your brain gets too many jobs, noises, choices, or feelings, it can freeze or burst into tears.</p>

            <div class="pillRow" aria-label="Signals and triggers">
              <span class="pillTag">fast breathing</span>
              <span class="pillTag">tight shoulders</span>
              <span class="pillTag">tummy flutter</span>
              <span class="pillTag trig">too many instructions</span>
              <span class="pillTag trig">time pressure</span>
              <span class="pillTag trig">loud noise / crowds</span>
            </div>

            <button class="btn btn-sky" onclick="showReactions()">See Behaviors</button>
          </div>

          <div class="white-card clickable-card" id="toolsHomeCard" style="border-bottom-color:#4338CA;">
            ${emojiScene("üóÇÔ∏è", ["üß†","ü§ù","‚úã"], "floaty glow")}
            <div class="card-title">Tools</div>
            <p class="card-desc">Sort the storm. Calm the body. Pick one tiny step. You don‚Äôt have to carry everything at once.</p>
            <button class="btn btn-indigo" onclick="showSolutions()">Show Comfort Tools</button>
          </div>
        </div>

        <div style="text-align:center; margin-top:26px;">
          <a href="index.html" style="color:#94A3B8; text-decoration:none; font-weight:800;">‚Üê Back to Menu</a>
        </div>
      `;

      // Whole Tools card is clickable (but emojis never block clicks)
      const toolsCard = document.getElementById('toolsHomeCard');
      if(toolsCard){
        toolsCard.addEventListener('click', (e) => {
          // Let the button do its normal job too
          if(e.target && e.target.tagName === 'BUTTON') return;
          showSolutions();
        });
      }
    }

    function showReactions(){
      SafeTimers.clearAll();
      container.innerHTML = `
        <button class="btn-back" onclick="showHome()">‚Üê Back</button>
        <h1 class="title accent-title">How Do I Act When I‚Äôm Overwhelmed?</h1>
        <p class="subtitle accent-sub" style="font-weight:800;">These are clues your brain has too much at once.</p>

        <div class="grid-2">
          <div class="white-card" style="border-bottom-color:#38BDF8;">
            ${emojiScene("üßä", ["üò∂","‚è∏Ô∏è","üß†"], "floaty")}
            <div class="card-title">I Freeze</div>
            <p class="card-desc">I stare, stop moving, or can‚Äôt start.</p>
          </div>

          <div class="white-card" style="border-bottom-color:#F59E0B;">
            ${emojiScene("üåã", ["üò¢","‚ö°","üí•"], "boing")}
            <div class="card-title">I Melt Down</div>
            <p class="card-desc">I cry, yell, or feel panicky.</p>
          </div>

          <div class="white-card" style="border-bottom-color:#6366F1;">
            ${emojiScene("üèÉ‚Äç‚û°Ô∏è", ["üö™","üôà","ü´•"], "floaty")}
            <div class="card-title">I Avoid</div>
            <p class="card-desc">I run away, hide, or say ‚ÄúI can‚Äôt!‚Äù</p>
          </div>

          <div class="white-card" style="border-bottom-color:#0EA5E9;">
            ${emojiScene("üò§", ["üóØÔ∏è","ü§è","üí¢"], "wobble")}
            <div class="card-title">I Get Snappy</div>
            <p class="card-desc">Small things feel huge, and I get mean or impatient.</p>
          </div>
        </div>

        <div class="white-card" style="margin-top:26px; border-bottom-color:#4338CA;">
          <p style="font-weight:900; font-size:20px; color:#3730A3; margin:0;">What can happen when overwhelm stays in charge?</p>
          <button class="btn btn-indigo" style="width:auto; margin-top:14px;" onclick="showConsequences()">See Consequences ‚ûî</button>
        </div>

        <div style="text-align:center; margin-top:26px;">
          <a href="index.html" style="color:#94A3B8; text-decoration:none; font-weight:800;">‚Üê Back to Menu</a>
        </div>
      `;
    }

    function showConsequences(){
      SafeTimers.clearAll();
      container.innerHTML = `
        <button class="btn-back" onclick="showReactions()">‚Üê Back</button>
        <h1 class="title accent-title">When Overwhelmed Takes Over‚Ä¶</h1>
        <p class="subtitle">Too much pressure makes everything harder.</p>

        <div class="grid-2">
          <div class="white-card" style="border-bottom-color:#F59E0B;">
            ${emojiScene("üß©", ["‚ùå","üìù","üòµ‚Äçüí´"], "wobble")}
            <div class="card-title">Mistakes Multiply</div>
            <p class="card-desc">Your brain can‚Äôt organize, so errors happen.</p>
          </div>

          <div class="white-card" style="border-bottom-color:#0EA5E9;">
            ${emojiScene("üö®", ["üíì","ü´Å","‚ö†Ô∏è"], "boing")}
            <div class="card-title">Body Alarm Stays On</div>
            <p class="card-desc">Your ‚Äústress alarm‚Äù keeps ringing, even when you want it to stop.</p>
          </div>

          <div class="white-card" style="border-bottom-color:#6366F1;">
            ${emojiScene("ü´§", ["üëÄ","üó£Ô∏è","‚ùì"], "floaty")}
            <div class="card-title">People Misunderstand Me</div>
            <p class="card-desc">Adults or friends may think I‚Äôm being ‚Äúdifficult.‚Äù</p>
          </div>

          <div class="white-card" style="border-bottom-color:#22C55E;">
            ${emojiScene("üß±", ["üõë","üìâ","üòî"], "floaty")}
            <div class="card-title">I Stop Trying</div>
            <p class="card-desc">Quitting can make me feel smaller next time.</p>
          </div>
        </div>

        <div class="white-card" style="margin-top:26px; border-bottom-color:#22C55E;">
          <p style="font-weight:900; font-size:20px; color:#166534; margin:0;">Good news: comfort tools can calm the storm and shrink the load.</p>
          <button class="btn btn-green" style="width:auto; margin-top:14px;" onclick="showSolutions()">Go to Comfort Tools ‚ûî</button>
        </div>

        <div style="text-align:center; margin-top:26px;">
          <a href="index.html" style="color:#94A3B8; text-decoration:none; font-weight:800;">‚Üê Back to Menu</a>
        </div>
      `;
    }

    // ---- Tool state ----
    let t1Interval = null;
    let t1Running = false;
    let t1Remain = 60;

    let groundingIndex = -1;

    let picked = [];
    let pickWarnTimer = null;

    function showSolutions(){
      SafeTimers.clearAll();
      container.innerHTML = `
        <button class="btn-back" onclick="showHome()">‚Üê Back to Start</button>
        <h1 class="title accent-title">Comfort Tools</h1>
        <p class="subtitle">Each tool is made for overwhelm: calm the body, unload the brain, then pick a tiny next step.</p>

        <div class="toolsStack">

          <!-- TOOL 1 -->
          <div class="white-card" style="border-bottom-color:#0EA5E9;">
            ${emojiScene("üå¨Ô∏è", ["ü´Å","‚è±Ô∏è","üßä"], "floaty glow")}
            <div class="card-title" style="color:#0EA5E9;">1-Minute Nervous System Reset (60s)</div>
            <p class="card-desc">Why it helps: slowing your breath can lower the stress alarm so thinking can come back.</p>

            <div class="mini-panel">
              <div class="phasePill" id="t1Status">Ready</div>
              <div class="timerBig" id="t1Time">60</div>
              <div class="progressBar" aria-label="60 second progress">
                <div class="progressFill" id="t1Fill"></div>
              </div>
              <div class="tinyNote" id="t1Hint">Breathe out a little longer than you breathe in.</div>
            </div>

            <div class="toolBtnRow">
              <button class="btn btn-sky" id="t1Start">Start</button>
              <button class="btn btn-indigo" id="t1Pause">Pause</button>
              <button class="btn btn-amber" id="t1Reset">Reset</button>
            </div>
          </div>

          <!-- TOOL 2 -->
          <div class="white-card" style="border-bottom-color:#4338CA;">
            ${emojiScene("üì¶", ["üìù","üß†","ü™∂"], "floaty")}
            <div class="card-title" style="color:#4338CA;">Brain Dump Box (Unload It)</div>
            <p class="card-desc">Why it helps: writing thoughts outside your head reduces brain-load and makes plans feel smaller.</p>

            <div class="field">
              <label class="label" for="dumpText">What feels like too much?</label>
              <textarea id="dumpText" placeholder="Type it here‚Ä¶"></textarea>
            </div>

            <div class="toolBtnRow">
              <button class="btn btn-indigo" id="dumpBtn">Dump It</button>
              <button class="btn btn-slate" id="dumpClear">Clear</button>
            </div>

            <div class="split3" id="dumpOut" style="display:none;">
              <div class="miniBox">
                <h4>Now</h4>
                <p id="dumpNow"></p>
              </div>
              <div class="miniBox">
                <h4>Later</h4>
                <p id="dumpLater"></p>
              </div>
              <div class="miniBox">
                <h4>Ask for help</h4>
                <p id="dumpHelp"></p>
              </div>
            </div>
          </div>

          <!-- TOOL 3 -->
          <div class="white-card" style="border-bottom-color:#22C55E;">
            ${emojiScene("ü™ú", ["ü§è","‚è≤Ô∏è","‚úÖ"], "boing")}
            <div class="card-title" style="color:#16A34A;">Tiny Next Step (Step Shrinker)</div>
            <p class="card-desc">Why it helps: task chunking + tiny action gets you unstuck without needing ‚Äúall the energy.‚Äù</p>

            <div class="field">
              <label class="label" for="bigTask">What‚Äôs the big task?</label>
              <input type="text" id="bigTask" placeholder="Example: homework / clean my room / get ready" />
            </div>

            <div class="toolBtnRow">
              <button class="btn btn-green" id="stepBtn">Shrink It</button>
              <button class="btn btn-slate" id="stepClear">Clear</button>
            </div>

            <div class="mini-panel" id="stepNext" style="display:none;"></div>
            <div class="mini-panel" id="stepList" style="display:none;"></div>
          </div>

          <!-- TOOL 4 -->
          <div class="white-card" style="border-bottom-color:#F59E0B;">
            ${emojiScene("üß≠", ["üëÄ","üëÇ","‚úã"], "floaty glow")}
            <div class="card-title" style="color:#D97706;">5-4-3-2-1 Grounding (Sense Scanner)</div>
            <p class="card-desc">Why it helps: focusing on senses anchors attention and slows the panic spiral.</p>

            <div class="mini-panel">
              <div class="phasePill" id="gStepPill">Step 0 / 5</div>
              <div style="font-weight:900; font-size:20px; margin-top:10px; color:#0F172A;" id="gLine">Press Next Step to begin.</div>
              <div class="tinyNote" id="gWhy">Your senses help your brain return to the present moment.</div>
            </div>

            <div class="toolBtnRow">
              <button class="btn btn-amber" id="gNext">Next Step</button>
              <button class="btn btn-slate" id="gRestart">Restart</button>
            </div>
          </div>

          <!-- TOOL 5 -->
          <div class="white-card" style="border-bottom-color:#0EA5E9;">
            ${emojiScene("üéØ", ["1Ô∏è‚É£","2Ô∏è‚É£","üß†"], "wobble")}
            <div class="card-title" style="color:#0EA5E9;">Priority Picker (Only 1‚Äì2 Things)</div>
            <p class="card-desc">Why it helps: limiting choices reduces overload and supports your planning brain.</p>

            <div class="chipWrap" id="chipWrap" aria-label="Task chips">
              <div class="chip" data-task="Homework">Homework</div>
              <div class="chip" data-task="Clean one area">Clean one area</div>
              <div class="chip" data-task="Get dressed">Get dressed</div>
              <div class="chip" data-task="Pack my bag">Pack my bag</div>
              <div class="chip" data-task="Snack & water">Snack & water</div>
              <div class="chip" data-task="Message someone">Message someone</div>
            </div>

            <div class="field">
              <label class="label" for="customTask">Add a custom task (optional)</label>
              <input type="text" id="customTask" placeholder="Type a task and press Add" />
            </div>

            <div class="toolBtnRow">
              <button class="btn btn-sky" id="addTask">Add</button>
              <button class="btn btn-amber" id="clearPicks">Clear Picks</button>
            </div>

            <div class="warn" id="pickWarn">Two is enough. Your brain likes small.</div>
            <div class="mini-panel" id="pickOut" style="font-weight:900; font-size:18px;">Today I only need: ______ and ______.</div>
          </div>

          <!-- TOOL 6 -->
          <div class="white-card" style="border-bottom-color:#6366F1;">
            ${emojiScene("üì£", ["ü§ù","üí¨","üß©"], "floaty")}
            <div class="card-title" style="color:#4338CA;">Help Signal Script (Ask-for-Help Builder)</div>
            <p class="card-desc">Why it helps: co-regulation + clear words can turn overwhelm into a doable plan.</p>

            <div class="grid-2" style="margin-top:14px;">
              <div class="mini-panel" style="text-align:left;">
                <div class="label">Who can help?</div>
                <select id="helpWho">
                  <option value="">Choose one‚Ä¶</option>
                  <option>Mom</option>
                  <option>Dad</option>
                  <option>Teacher</option>
                  <option>Coach</option>
                  <option>Friend</option>
                  <option>Grandparent</option>
                </select>
                <div class="tinyNote" style="margin-top:10px;">Or type a name:</div>
                <input type="text" id="helpWhoCustom" placeholder="Example: Ms. Rivera" />
              </div>

              <div class="mini-panel" style="text-align:left;">
                <div class="label">What do you need?</div>
                <select id="helpNeed">
                  <option value="">Choose one‚Ä¶</option>
                  <option>more time</option>
                  <option>help with one step</option>
                  <option>a quiet spot</option>
                  <option>someone to sit with me</option>
                  <option>help choosing what to do first</option>
                </select>
                <div class="tinyNote" style="margin-top:10px;">Or type your need:</div>
                <input type="text" id="helpNeedCustom" placeholder="Example: a 5-minute break" />
              </div>
            </div>

            <div class="toolBtnRow">
              <button class="btn btn-indigo" id="buildScript">Build Script</button>
              <button class="btn btn-sky" id="copyScript">Copy</button>
              <button class="btn btn-slate" id="clearScript">Clear</button>
            </div>

            <div class="mini-panel" id="scriptOut" style="font-weight:900; font-size:18px;">
              Hi ____. I feel overwhelmed. Can you help me by ____?
            </div>
          </div>

        </div>

        <div style="text-align:center; margin-top:26px;">
          <a href="index.html" style="color:#94A3B8; text-decoration:none; font-weight:800;">‚Üê Back to Menu</a>
        </div>
      `;

      resetToolStates();
      bindTools();
    }

    // ---- Tool helpers ----
    function resetToolStates(){
      // Tool 1
      t1Running = false;
      t1Remain = 60;
      if(t1Interval){ clearInterval(t1Interval); t1Interval = null; }

      // Tool 4
      groundingIndex = -1;

      // Tool 5
      picked = [];
      if(pickWarnTimer){ clearTimeout(pickWarnTimer); pickWarnTimer = null; }
    }

    function bindTools(){
      // ---------- TOOL 1 (60s timer) ----------
      const t1Status = document.getElementById('t1Status');
      const t1Time   = document.getElementById('t1Time');
      const t1Fill   = document.getElementById('t1Fill');
      const t1Hint   = document.getElementById('t1Hint');
      const bStart   = document.getElementById('t1Start');
      const bPause   = document.getElementById('t1Pause');
      const bReset   = document.getElementById('t1Reset');

      function t1Update(){
        if(!t1Time || !t1Fill || !t1Status) return;
        t1Time.textContent = String(t1Remain);
        const done = 60 - t1Remain;
        t1Fill.style.width = ((done / 60) * 100).toFixed(2) + '%';
        if(t1Remain === 60 && !t1Running) t1Status.textContent = "Ready";
        else if(t1Running) t1Status.textContent = "Running";
        else t1Status.textContent = "Paused";
      }

      function t1Finish(){
        t1Running = false;
        if(t1Interval){ clearInterval(t1Interval); t1Interval = null; }
        t1Status.textContent = "Done";
        t1Hint.textContent = "Nice. Your body got the message. Now pick one tiny next step.";
        t1Fill.style.width = "100%";
      }

      if(bStart){
        bStart.addEventListener('click', () => {
          if(t1Running) return;
          if(t1Remain === 0) t1Remain = 60;
          t1Running = true;
          t1Hint.textContent = "Breathe out a little longer than you breathe in.";
          t1Update();
          if(!t1Interval){
            t1Interval = SafeTimers.setI(() => {
              if(!t1Running) return;
              t1Remain--;
              if(t1Remain <= 0){
                t1Remain = 0;
                t1Update();
                t1Finish();
              } else {
                t1Update();
              }
            }, 1000);
          }
        });
      }

      if(bPause){
        bPause.addEventListener('click', () => {
          if(!t1Running){
            t1Hint.textContent = "Paused is okay. Press Start when you‚Äôre ready.";
            return;
          }
          t1Running = false;
          t1Update();
          t1Hint.textContent = "Paused. Keep shoulders soft.";
        });
      }

      if(bReset){
        bReset.addEventListener('click', () => {
          t1Running = false;
          t1Remain = 60;
          t1Hint.textContent = "Breathe out a little longer than you breathe in.";
          t1Update();
        });
      }

      t1Update();

      // ---------- TOOL 2 (Brain Dump) ----------
      const dumpText = document.getElementById('dumpText');
      const dumpBtn  = document.getElementById('dumpBtn');
      const dumpClear= document.getElementById('dumpClear');
      const dumpOut  = document.getElementById('dumpOut');
      const dumpNow  = document.getElementById('dumpNow');
      const dumpLater= document.getElementById('dumpLater');
      const dumpHelp = document.getElementById('dumpHelp');

      function cleanText(s){ return (s || "").replace(/\s+/g, " ").trim(); }
      function splitSentences(s){
        const raw = (s || "").trim();
        if(!raw) return [];
        const parts = raw.match(/[^.!?]+[.!?]?/g) || [raw];
        return parts.map(x => cleanText(x)).filter(Boolean);
      }
      function makePlan(text){
        const t = cleanText(text);
        const sents = splitSentences(t);

        let now="", later="", help="";
        if(sents.length >= 3){
          now = sents[0];
          later = sents.slice(1, -1).join(" ");
          help = sents[sents.length - 1];
        } else if(sents.length === 2){
          now = sents[0];
          later = sents[1];
          help = "Tell someone: ‚ÄúI have too much at once. Can you help me pick the first step?‚Äù";
        } else if(sents.length === 1){
          now = "Do 60 seconds of slow breathing, then choose the smallest piece of: " + sents[0];
          later = "The rest can wait until after one tiny step.";
          help = "Ask: ‚ÄúCan you help me break this into smaller steps?‚Äù";
        } else {
          now = "Start with one slow breath.";
          later = "Then choose one tiny step.";
          help = "Ask a grown-up or friend for help.";
        }
        return { now, later, help };
      }

      if(dumpBtn){
        dumpBtn.addEventListener('click', () => {
          const plan = makePlan(dumpText ? dumpText.value : "");
          if(dumpNow) dumpNow.textContent = plan.now;
          if(dumpLater) dumpLater.textContent = plan.later;
          if(dumpHelp) dumpHelp.textContent = plan.help;
          if(dumpOut) dumpOut.style.display = "grid";
        });
      }
      if(dumpClear){
        dumpClear.addEventListener('click', () => {
          if(dumpText) dumpText.value = "";
          if(dumpOut) dumpOut.style.display = "none";
        });
      }

      // ---------- TOOL 3 (Step Shrinker) ----------
      const bigTask = document.getElementById('bigTask');
      const stepBtn = document.getElementById('stepBtn');
      const stepClear = document.getElementById('stepClear');
      const stepNext = document.getElementById('stepNext');
      const stepList = document.getElementById('stepList');

      function buildMicroSteps(task){
        const t = cleanText(task) || "this task";
        return [
          "Look at ‚Äú" + t + "‚Äù and circle just one small part.",
          "Set a 2-minute timer and start that one part.",
          "Stop and check: ‚ÄúWhat‚Äôs the next tiny piece?‚Äù",
          "Do one more 2-minute round (or one item).",
          "Put a check mark, then take a short reset break."
        ];
      }

      if(stepBtn){
        stepBtn.addEventListener('click', () => {
          const steps = buildMicroSteps(bigTask ? bigTask.value : "");
          if(stepNext){
            stepNext.style.display = "block";
            stepNext.innerHTML = "<span class='phasePill'>Next Step</span><div style='margin-top:10px; font-weight:900; font-size:18px; color:#0F172A;'>" + steps[0] + "</div>";
          }
          if(stepList){
            stepList.style.display = "block";
            stepList.innerHTML = "<div style='font-weight:900; font-size:18px; color:#0F172A;'>5 micro-steps</div><div style='margin-top:10px; color:#475569; font-weight:800; line-height:1.5; text-align:left; max-width:560px; margin-left:auto; margin-right:auto;'>" +
              steps.map((s,i)=> (i+1)+". "+s).join("<br>") +
            "</div>";
          }
        });
      }
      if(stepClear){
        stepClear.addEventListener('click', () => {
          if(bigTask) bigTask.value = "";
          if(stepNext) stepNext.style.display = "none";
          if(stepList) stepList.style.display = "none";
        });
      }

      // ---------- TOOL 4 (5-4-3-2-1) ----------
      const gStepPill = document.getElementById('gStepPill');
      const gLine = document.getElementById('gLine');
      const gNext = document.getElementById('gNext');
      const gRestart = document.getElementById('gRestart');

      const groundingSteps = [
        "5 things you see. Name them slowly.",
        "4 things you feel/touch. Describe one.",
        "3 things you hear. Even tiny sounds count.",
        "2 things you smell. If none, imagine a favorite smell.",
        "1 thing you taste. Or sip water and notice it."
      ];

      function gRender(){
        if(!gStepPill || !gLine) return;
        if(groundingIndex < 0){
          gStepPill.textContent = "Step 0 / 5";
          gLine.textContent = "Press Next Step to begin.";
          return;
        }
        const stepNum = groundingIndex + 1;
        gStepPill.textContent = "Step " + stepNum + " / 5";
        gLine.textContent = groundingSteps[groundingIndex] || "Done.";
      }

      if(gNext){
        gNext.addEventListener('click', () => {
          groundingIndex = Math.min(4, groundingIndex + 1);
          gRender();
          if(groundingIndex === 4 && gLine){
            SafeTimers.setT(() => {
              gStepPill.textContent = "Done";
              gLine.textContent = "Nice. Your brain is back in the room. Now choose one tiny step.";
            }, 350);
          }
        });
      }
      if(gRestart){
        gRestart.addEventListener('click', () => {
          groundingIndex = -1;
          gRender();
        });
      }
      gRender();

      // ---------- TOOL 5 (Priority Picker) ----------
      const chipWrap = document.getElementById('chipWrap');
      const customTask = document.getElementById('customTask');
      const addTask = document.getElementById('addTask');
      const clearPicks = document.getElementById('clearPicks');
      const pickWarn = document.getElementById('pickWarn');
      const pickOut = document.getElementById('pickOut');

      function showPickWarn(){
        if(!pickWarn) return;
        pickWarn.classList.add('show');
        if(pickWarnTimer) clearTimeout(pickWarnTimer);
        pickWarnTimer = SafeTimers.setT(() => pickWarn.classList.remove('show'), 1600);
      }

      function updatePickOut(){
        if(!pickOut) return;
        const a = picked[0] || "______";
        const b = picked[1] || "______";
        pickOut.textContent = "Today I only need: " + a + " and " + b + ".";
      }

      function setChipState(){
        if(!chipWrap) return;
        chipWrap.querySelectorAll('.chip').forEach(ch => {
          const t = ch.getAttribute('data-task');
          if(picked.includes(t)) ch.classList.add('on');
          else ch.classList.remove('on');
        });
      }

      if(chipWrap){
        chipWrap.addEventListener('click', (e) => {
          const chip = e.target.closest('.chip');
          if(!chip) return;
          const t = chip.getAttribute('data-task');

          if(chip.classList.contains('on')){
            picked = picked.filter(x => x !== t);
            setChipState();
            updatePickOut();
            return;
          }

          if(picked.length >= 2){
            showPickWarn();
            return;
          }

          picked.push(t);
          setChipState();
          updatePickOut();
        });
      }

      if(addTask){
        addTask.addEventListener('click', () => {
          const t = cleanText(customTask ? customTask.value : "");
          if(!t){
            if(pickWarn){
              pickWarn.textContent = "Type a task first, then press Add.";
              showPickWarn();
              SafeTimers.setT(() => { pickWarn.textContent = "Two is enough. Your brain likes small."; }, 900);
            }
            return;
          }

          if(!chipWrap) return;
          const div = document.createElement('div');
          div.className = 'chip';
          div.setAttribute('data-task', t);
          div.textContent = t;
          chipWrap.appendChild(div);
          if(customTask) customTask.value = "";
        });
      }

      if(clearPicks){
        clearPicks.addEventListener('click', () => {
          picked = [];
          setChipState();
          updatePickOut();
          if(pickWarn) pickWarn.classList.remove('show');
        });
      }

      updatePickOut();

      // ---------- TOOL 6 (Help Script) ----------
      const helpWho = document.getElementById('helpWho');
      const helpWhoCustom = document.getElementById('helpWhoCustom');
      const helpNeed = document.getElementById('helpNeed');
      const helpNeedCustom = document.getElementById('helpNeedCustom');

      const buildScript = document.getElementById('buildScript');
      const copyScript = document.getElementById('copyScript');
      const clearScript = document.getElementById('clearScript');
      const scriptOut = document.getElementById('scriptOut');

      function currentWho(){
        const c = cleanText(helpWhoCustom ? helpWhoCustom.value : "");
        return c || (helpWho && helpWho.value) || "____";
      }
      function currentNeed(){
        const c = cleanText(helpNeedCustom ? helpNeedCustom.value : "");
        return c || (helpNeed && helpNeed.value) || "____";
      }
      function build(){
        return "Hi " + currentWho() + ". I feel overwhelmed. Can you help me by " + currentNeed() + "?";
      }

      if(buildScript){
        buildScript.addEventListener('click', () => {
          if(!scriptOut) return;
          scriptOut.textContent = build();
        });
      }

      if(copyScript){
        copyScript.addEventListener('click', async () => {
          if(!scriptOut) return;
          const s = scriptOut.textContent || build();
          try{
            await navigator.clipboard.writeText(s);
            scriptOut.textContent = s + " (Copied!)";
            SafeTimers.setT(() => { scriptOut.textContent = s; }, 900);
          } catch(e){
            scriptOut.textContent = s + " (Copy not available here‚Äîselect and copy.)";
          }
        });
      }

      if(clearScript){
        clearScript.addEventListener('click', () => {
          if(helpWho) helpWho.value = "";
          if(helpNeed) helpNeed.value = "";
          if(helpWhoCustom) helpWhoCustom.value = "";
          if(helpNeedCustom) helpNeedCustom.value = "";
          if(scriptOut) scriptOut.textContent = "Hi ____. I feel overwhelmed. Can you help me by ____?";
        });
      }
    }

    // Expose navigation (matches your pattern across pages)
    window.showHome = showHome;
    window.showReactions = showReactions;
    window.showConsequences = showConsequences;
    window.showSolutions = showSolutions;

    showHome();
  </script>
</body>
</html>
