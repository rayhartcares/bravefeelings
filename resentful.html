<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Understanding Resentful</title>

  <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600&display=swap" rel="stylesheet">

  <style>
    body{
      margin:0; padding:0;
      background:#F4FAFF;
      font-family:'Fredoka',sans-serif;
      color:#1F2937;
      display:flex; justify-content:center;
      min-height:100vh;
      overflow-x:hidden;
    }
    #app-container{
      width:100%;
      max-width:860px;
      padding:44px 18px;
      position:relative;
    }

    .white-card{
      background:white;
      border-radius:26px;
      padding:30px;
      box-shadow:0 10px 26px rgba(0,0,0,0.06);
      text-align:center;
      margin-bottom:24px;
      border-bottom:7px solid #E5E7EB;
      position:relative;
      overflow:visible;
      transition:transform .18s ease;
    }
    .white-card:hover{ transform: translateY(-4px); }

    .title{
      font-size:40px;
      font-weight:800;
      text-align:center;
      margin:0 0 8px 0;
      letter-spacing:.2px;
      color:#0F172A;
    }
    .subtitle{
      text-align:center;
      color:#64748B;
      margin:0 0 34px 0;
      font-size:18px;
      line-height:1.45;
    }
    .violet-title{ color:#6D28D9; }

    .card-title{
      font-size:22px;
      font-weight:800;
      margin:10px 0 6px 0;
      color:#0F172A;
    }
    .card-desc{
      font-size:16px;
      color:#64748B;
      line-height:1.55;
      margin:0;
    }

    .btn{
      padding:14px 22px;
      border-radius:16px;
      font-weight:800;
      font-size:18px;
      border:none;
      cursor:pointer;
      color:white;
      transition:transform .2s ease, filter .2s ease;
      width:100%;
      margin-top:16px;
      box-shadow:0 7px 16px rgba(0,0,0,0.12);
    }
    .btn:hover{ transform: scale(1.02); filter: brightness(1.06); }
    .btn:disabled{ opacity:.75; cursor:not-allowed; transform:none; }

    .btn-violet { background: linear-gradient(135deg, #8B5CF6, #6D28D9); }
    .btn-indigo { background: linear-gradient(135deg, #6366F1, #4338CA); }
    .btn-sky    { background: linear-gradient(135deg, #38BDF8, #0EA5E9); }
    .btn-teal   { background: linear-gradient(135deg, #2DD4BF, #0D9488); }
    .btn-amber  { background: linear-gradient(135deg, #FBBF24, #D97706); }
    .btn-rose   { background: linear-gradient(135deg, #FB7185, #E11D48); }
    .btn-green  { background: linear-gradient(135deg, #34D399, #16A34A); }

    .btn-back{
      background:white;
      border:2px solid #CBD5E1;
      color:#334155;
      padding:9px 16px;
      border-radius:14px;
      font-weight:800;
      cursor:pointer;
      margin-bottom:18px;
    }

    .grid-2{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:22px;
    }
    @media (max-width:650px){
      .grid-2{ grid-template-columns:1fr; }
    }

    /* Emoji scenes (kid-friendly, big, simple) */
    .emojiScene{
      width: clamp(210px, 60vw, 320px);
      height: 178px;
      margin: 0 auto 10px auto;
      border-radius: 22px;
      position: relative;
      overflow:hidden;
      border:2px dashed rgba(109,40,217,.25);
      background:
        radial-gradient(circle at 18% 28%, rgba(139,92,246,.20), transparent 55%),
        radial-gradient(circle at 78% 70%, rgba(14,165,233,.14), transparent 58%),
        linear-gradient(135deg, rgba(255,255,255,.0), rgba(109,40,217,.05));
    }
    .emojiScene.altA{
      border-color: rgba(14,165,233,.25);
      background:
        radial-gradient(circle at 18% 28%, rgba(14,165,233,.18), transparent 55%),
        radial-gradient(circle at 78% 70%, rgba(99,102,241,.14), transparent 58%),
        linear-gradient(135deg, rgba(255,255,255,.0), rgba(14,165,233,.05));
    }
    .emojiScene.altB{
      border-color: rgba(217,119,6,.25);
      background:
        radial-gradient(circle at 18% 28%, rgba(245,158,11,.18), transparent 55%),
        radial-gradient(circle at 78% 70%, rgba(236,72,153,.12), transparent 58%),
        linear-gradient(135deg, rgba(255,255,255,.0), rgba(245,158,11,.05));
    }
    .emojiScene.altC{
      border-color: rgba(13,148,136,.25);
      background:
        radial-gradient(circle at 18% 28%, rgba(45,212,191,.16), transparent 55%),
        radial-gradient(circle at 78% 70%, rgba(34,197,94,.12), transparent 58%),
        linear-gradient(135deg, rgba(255,255,255,.0), rgba(13,148,136,.05));
    }
    .emojiScene.altD{
      border-color: rgba(225,29,72,.22);
      background:
        radial-gradient(circle at 18% 28%, rgba(251,113,133,.16), transparent 55%),
        radial-gradient(circle at 78% 70%, rgba(139,92,246,.12), transparent 58%),
        linear-gradient(135deg, rgba(255,255,255,.0), rgba(225,29,72,.05));
    }

    .emoMain{
      position:absolute;
      left:50%;
      top:52%;
      transform: translate(-50%, -50%);
      font-size: 86px;
      line-height: 1;
      user-select:none;
      filter: drop-shadow(0 16px 18px rgba(0,0,0,0.18));
      font-family: "Segoe UI Emoji","Apple Color Emoji","Noto Color Emoji",sans-serif;
    }
    .emoMini{
      position:absolute;
      font-size: 34px;
      line-height: 1;
      user-select:none;
      filter: drop-shadow(0 12px 14px rgba(0,0,0,0.14));
      font-family: "Segoe UI Emoji","Apple Color Emoji","Noto Color Emoji",sans-serif;
      opacity:.98;
    }
    .m1{ left:16px; top:16px; }
    .m2{ right:16px; top:16px; }
    .m3{ right:18px; bottom:14px; }

    /* Animations */
    @keyframes floaty{ 0%,100%{ transform: translate(-50%,-50%) translateY(0) scale(1); } 50%{ transform: translate(-50%,-50%) translateY(-12px) scale(1.03); } }
    @keyframes wobble{ 0%{ transform: rotate(0deg) } 25%{ transform: rotate(6deg) } 50%{ transform: rotate(0deg) } 75%{ transform: rotate(-6deg) } 100%{ transform: rotate(0deg) } }
    @keyframes boing{ 0%,100%{ transform: translate(-50%,-50%) scale(1) } 50%{ transform: translate(-50%,-50%) scale(1.18) } }
    @keyframes popOnce{ 0%{ transform: translate(-50%,-50%) scale(1) } 45%{ transform: translate(-50%,-50%) scale(1.18) } 100%{ transform: translate(-50%,-50%) scale(1) } }
    @keyframes shakeOnce{
      0%,100%{ transform: translate(-50%,-50%) rotate(0deg); }
      20%{ transform: translate(-50%,-50%) rotate(-4deg); }
      40%{ transform: translate(-50%,-50%) rotate(4deg); }
      60%{ transform: translate(-50%,-50%) rotate(-3deg); }
      80%{ transform: translate(-50%,-50%) rotate(3deg); }
    }

    .floaty .emoMain{ animation: floaty 2.6s infinite ease-in-out; }
    .wobble .emoMain{ animation: wobble 0.9s infinite ease-in-out; }
    .boing  .emoMain{ animation: boing  1.1s infinite ease-in-out; }

    .sceneActive .emoMain{ animation: popOnce .55s ease-in-out 1; }
    .sceneShake  .emoMain{ animation: shakeOnce .55s ease-in-out 1; }

    .pillRow{
      display:flex;
      flex-wrap:wrap;
      justify-content:center;
      gap:10px;
      margin-top:14px;
    }
    .pill{
      display:inline-block;
      padding:6px 12px;
      border-radius:999px;
      font-weight:800;
      font-size:13px;
      background:#F3E8FF;
      color:#5B21B6;
      border:1px solid rgba(109,40,217,.18);
    }
    .pill.alt{ background:#E0F2FE; color:#075985; border-color: rgba(14,165,233,.18); }

    .mini-panel{
      background:#F8FAFC;
      border:2px dashed #CBD5E1;
      border-radius:18px;
      padding:14px;
      margin-top:12px;
      text-align:center;
    }
    .bubble{
      display:none;
      background:#F3E8FF;
      border:2px solid #DDD6FE;
      color:#4C1D95;
      padding:14px 14px;
      border-radius:18px;
      font-weight:800;
      margin-top:12px;
    }

    /* Tool-specific UI */
    .timerFace{
      font-size:34px;
      font-weight:900;
      margin-top:10px;
      color:#0F172A;
      min-height:44px;
    }
    .bar{
      width:100%;
      height:14px;
      background: rgba(15,23,42,.10);
      border-radius:999px;
      overflow:hidden;
      border:1px solid rgba(15,23,42,.10);
      margin-top:10px;
    }
    .bar > div{
      height:100%;
      width:0%;
      background: linear-gradient(90deg, rgba(139,92,246,.80), rgba(14,165,233,.60));
      transition: width .2s ease;
    }
    .rowBtns{
      display:grid;
      grid-template-columns:1fr 1fr 1fr;
      gap:12px;
      margin-top:14px;
    }
    @media (max-width:650px){ .rowBtns{ grid-template-columns:1fr; } }

    .inputRow{
      display:grid;
      grid-template-columns:1fr;
      gap:10px;
      margin-top:12px;
    }
    .inputRow input, .inputRow textarea{
      width:100%;
      font-family:inherit;
      padding:12px 12px;
      border-radius:16px;
      border:1px solid rgba(15,23,42,.14);
      outline:none;
      background: rgba(255,255,255,.96);
      box-shadow: inset 0 1px 0 rgba(0,0,0,.04);
      font-size:15px;
    }
    .inputRow textarea{ min-height:46px; resize:vertical; }

    .result{
      margin-top:12px;
      padding:14px 14px;
      border-radius:18px;
      border:2px solid rgba(109,40,217,.16);
      background: rgba(139,92,246,.09);
      color:#3B0764;
      font-weight:900;
      line-height:1.35;
      display:none;
      text-align:left;
    }
    .result small{
      display:block;
      margin-top:10px;
      color: rgba(59,7,100,.72);
      font-weight:800;
    }

    .checklist{
      display:grid;
      grid-template-columns:1fr;
      gap:10px;
      margin-top:12px;
      text-align:left;
    }
    .checkItem{
      display:flex;
      gap:12px;
      align-items:flex-start;
      padding:12px;
      border-radius:18px;
      border:1px solid rgba(13,148,136,.14);
      background: rgba(45,212,191,.08);
    }
    .checkItem input{ margin-top:3px; transform:scale(1.2); }
    .checkItem label{
      font-weight:900;
      color:#134E4A;
      cursor:pointer;
      line-height:1.25;
    }

    .meter{
      margin-top:12px;
      padding:12px 14px;
      border-radius:18px;
      border:1px solid rgba(13,148,136,.14);
      background: rgba(45,212,191,.07);
      font-weight:900;
      color:#134E4A;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:12px;
      flex-wrap:wrap;
    }

    .tinyGrid{
      display:grid;
      grid-template-columns:1fr 1fr 1fr;
      gap:12px;
      margin-top:12px;
    }
    @media (max-width:650px){ .tinyGrid{ grid-template-columns:1fr; } }

    .tinyChoice{
      border:2px solid rgba(217,119,6,.16);
      background: rgba(251,191,36,.14);
      border-radius:18px;
      padding:14px 12px;
      cursor:pointer;
      font-family:inherit;
      font-weight:900;
      color:#7C2D12;
      box-shadow: 0 8px 16px rgba(0,0,0,0.08);
      transition: transform .18s ease, filter .18s ease;
      text-align:left;
    }
    .tinyChoice:hover{ transform: translateY(-2px); filter: brightness(1.04); }

    .backLink{
      color:#94A3B8;
      text-decoration:none;
      font-weight:800;
    }
  </style>
</head>

<body>
  <div id="app-container"></div>

  <script>
    const container = document.getElementById('app-container');

    // ===== Robust interval/timeout management =====
    const _intervals = [];
    const _timeouts  = [];
    function addInterval(id){ _intervals.push(id); return id; }
    function addTimeout(id){ _timeouts.push(id); return id; }

    function clearAllIntervals(){
      while(_intervals.length){
        const id = _intervals.pop();
        try{ clearInterval(id); }catch(e){}
      }
      while(_timeouts.length){
        const id = _timeouts.pop();
        try{ clearTimeout(id); }catch(e){}
      }
      // also reset tool-running flags safely
      timerRunning = false;
      detectiveHintShown = false;
    }

    function scene(main, a, b, c, sceneClass, altClass, id){
      return `
        <div class="emojiScene ${altClass || ""} ${sceneClass || ""}" ${id ? `id="${id}"` : ""} aria-hidden="true">
          <div class="emoMain">${main}</div>
          <div class="emoMini m1">${a}</div>
          <div class="emoMini m2">${b}</div>
          <div class="emoMini m3">${c}</div>
        </div>
      `;
    }

    function pingScene(id, kind){
      const el = document.getElementById(id);
      if(!el) return;
      el.classList.remove('sceneActive','sceneShake');
      void el.offsetWidth;
      if(kind === 'shake') el.classList.add('sceneShake');
      else el.classList.add('sceneActive');
      addTimeout(setTimeout(()=>{ el.classList.remove('sceneActive','sceneShake'); }, 650));
    }

    // ===== Views =====
    function showHome(){
      clearAllIntervals();
      container.innerHTML = `
        <h1 class="title">Understanding Resentful</h1>
        <p class="subtitle">Resentful is a â€œnot fair!â€ feeling that sticks like glue. Letâ€™s unstick itâ€”gently.</p>

        <div class="grid-2">
          <div class="white-card" style="border-bottom-color:#8B5CF6;">
            ${scene("ğŸ˜’","ğŸ’­","ğŸ§Š","â›“ï¸","floaty","", "")}
            <div class="card-title">The Sticky Grudge</div>
            <p class="card-desc">â€œIâ€™m still mad about what happenedâ€¦ and my heart wonâ€™t let it go.â€</p>

            <div class="pillRow">
              <span class="pill">Body: tight jaw</span>
              <span class="pill">Body: hot cheeks</span>
              <span class="pill">Body: tummy twist</span>
              <span class="pill alt">Trigger: unfair rules</span>
              <span class="pill alt">Trigger: being blamed</span>
              <span class="pill alt">Trigger: someone else picked</span>
            </div>

            <button class="btn btn-violet" onclick="showReactions()">See Behaviors</button>
          </div>

          <div class="white-card" style="border-bottom-color:#4338CA;">
            ${scene("ğŸ§°","ğŸ§ ","ğŸ›¡ï¸","âœ¨","floaty","altA","")}
            <div class="card-title">Comfort Tools</div>
            <p class="card-desc">Simple, kid-friendly tools to calm your body and choose smart words.</p>
            <button class="btn btn-indigo" onclick="showSolutions()">Show Comfort Tools</button>
          </div>
        </div>

        <div style="text-align:center; margin-top:26px;">
          <a href="index.html" class="backLink">â† Back to Menu</a>
        </div>
      `;
    }

    function showReactions(){
      clearAllIntervals();
      container.innerHTML = `
        <button class="btn-back" onclick="showHome()">â† Back</button>
        <h1 class="title violet-title">How Do I Act When Iâ€™m Resentful?</h1>
        <p class="subtitle" style="color:#6D28D9; font-weight:800;">These are clues: your feelings need care, not payback.</p>

        <div class="grid-2">
          <div class="white-card" style="border-bottom-color:#A78BFA;">
            ${scene("ğŸ§Š","ğŸ˜’","ğŸ™…â€â™€ï¸","ğŸ‘«","wobble","altA","")}
            <div class="card-title">Cold Shoulder</div>
            <p class="card-desc">I pull away, ignore, or act distantâ€”even if I still care.</p>
          </div>

          <div class="white-card" style="border-bottom-color:#A78BFA;">
            ${scene("ğŸ§®","ğŸ§¾","ğŸ‘€","ğŸ˜‘","floaty","altB","")}
            <div class="card-title">Keeping Score</div>
            <p class="card-desc">My brain counts who did whatâ€”like a secret points chart.</p>
          </div>

          <div class="white-card" style="border-bottom-color:#A78BFA;">
            ${scene("ğŸ—¯ï¸","ğŸ˜¤","ğŸ”¥","ğŸ‘‚","boing","altD","")}
            <div class="card-title">Snappy Words</div>
            <p class="card-desc">My voice gets sharp. I might â€œbiteâ€ with my tone.</p>
          </div>

          <div class="white-card" style="border-bottom-color:#A78BFA;">
            ${scene("ğŸ¯","ğŸ¤«","ğŸ™ˆ","ğŸ˜¬","wobble","altC","")}
            <div class="card-title">Tiny Payback Plan</div>
            <p class="card-desc">I want to â€œget evenâ€ with a little sneaky move.</p>
          </div>
        </div>

        <div class="white-card" style="margin-top:26px; border-bottom-color:#0EA5E9;">
          <p style="font-weight:900; font-size:20px; color:#075985; margin:0;">What happens if resentment stays in charge?</p>
          <button class="btn btn-sky" style="width:auto; margin-top:14px;" onclick="showConsequences()">See Consequences â”</button>
        </div>
      `;
    }

    function showConsequences(){
      clearAllIntervals();
      container.innerHTML = `
        <button class="btn-back" onclick="showReactions()">â† Back</button>
        <h1 class="title violet-title">When Resentment Stays Too Longâ€¦</h1>
        <p class="subtitle">It can make your heart heavy and your friendships wobbly.</p>

        <div class="grid-2">
          <div class="white-card" style="border-bottom-color:#60A5FA;">
            ${scene("ğŸ§â€â™€ï¸â†”ï¸ğŸ§â€â™‚ï¸","ğŸ“","ğŸ§Š","ğŸ’”","floaty","altA","")}
            <div class="card-title">Friendships Feel Far</div>
            <p class="card-desc">Itâ€™s harder to trust, laugh, or play together.</p>
          </div>

          <div class="white-card" style="border-bottom-color:#60A5FA;">
            ${scene("ğŸ’","ğŸ§±","â›“ï¸","ğŸ˜®â€ğŸ’¨","wobble","altB","")}
            <div class="card-title">Heavy Backpack Feeling</div>
            <p class="card-desc">Holding a grudge can feel like carrying rocks all day.</p>
          </div>

          <div class="white-card" style="border-bottom-color:#60A5FA;">
            ${scene("ğŸ‰","ğŸš«","ğŸ˜•","ğŸ«§","boing","altD","")}
            <div class="card-title">You Miss the Fun</div>
            <p class="card-desc">Your brain replays â€œnot fair,â€ so now feels less bright.</p>
          </div>

          <div class="white-card" style="border-bottom-color:#60A5FA;">
            ${scene("ğŸŒ€","ğŸ’“","âš¡","ğŸ˜£","floaty","altC","")}
            <div class="card-title">Body Stays Tight</div>
            <p class="card-desc">Tension sticks aroundâ€”jaw, shoulders, belly.</p>
          </div>
        </div>

        <div class="white-card" style="margin-top:26px; border-bottom-color:#16A34A;">
          <p style="font-weight:900; font-size:20px; color:#166534; margin:0;">Good news: tools can unstick your heart.</p>
          <button class="btn btn-green" style="width:auto; margin-top:14px;" onclick="showSolutions()">Go to Comfort Tools â”</button>
        </div>
      `;
    }

    function showSolutions(){
      clearAllIntervals();
      container.innerHTML = `
        <button class="btn-back" onclick="showHome()">â† Back to Start</button>
        <h1 class="title violet-title">Comfort Tools</h1>
        <p class="subtitle">Each tool is simple and kid-friendlyâ€”so your brain can switch from â€œfightâ€ to â€œwise.â€</p>

        <div style="display:flex; flex-direction:column; gap:26px; margin-top:18px;">

          <!-- TOOL 1: 60-second timer -->
          <div class="white-card" style="border-bottom-color:#6D28D9;">
            ${scene("â±ï¸","ğŸ§Š","ğŸŒ¬ï¸","ğŸ«§","floaty","", "sceneTimer")}
            <div class="card-title" style="color:#6D28D9;">Melt-the-Ice Minute (60 seconds)</div>
            <p class="card-desc">One calm minute helps your body cool down so your thinking brain can help again.</p>

            <div class="mini-panel">
              <div class="pill" id="timerLabel">Timer</div>
              <div class="timerFace" id="timerFace">01:00</div>
              <div style="color:#64748B; font-weight:800;" id="timerHint">Slow breathâ€¦ soft shouldersâ€¦</div>
              <div class="bar" aria-label="timer progress"><div id="timerBar"></div></div>
            </div>

            <div class="rowBtns">
              <button class="btn btn-violet" style="margin-top:0;" onclick="startTimer()">Start</button>
              <button class="btn btn-sky" style="margin-top:0;" onclick="pauseTimer()">Pause</button>
              <button class="btn btn-rose" style="margin-top:0;" onclick="resetTimer()">Reset</button>
            </div>
          </div>

          <!-- TOOL 2: Words tool (builder) -->
          <div class="white-card" style="border-bottom-color:#E11D48;">
            ${scene("ğŸ—£ï¸","â¤ï¸","ğŸ§ ","ğŸ§©","boing","altD", "sceneWords")}
            <div class="card-title" style="color:#E11D48;">Kind Words Builder</div>
            <p class="card-desc">Putting feelings into words helps your brain organize the storm and choose calm steps.</p>

            <div class="inputRow">
              <input id="unfairInput" type="text" placeholder="What felt unfair? (example: â€œThey blamed me.â€)" />
              <input id="needInput" type="text" placeholder="What did you need? (example: â€œTo be heard.â€)" />
            </div>

            <button class="btn btn-rose" onclick="buildWords()">Build my sentence</button>
            <div class="result" id="wordsResult"></div>
          </div>

          <!-- TOOL 3: Thought Detective -->
          <div class="white-card" style="border-bottom-color:#D97706;">
            ${scene("ğŸ”","âš–ï¸","â“","âœ…","floaty","altB", "sceneDetective")}
            <div class="card-title" style="color:#D97706;">Detective Mode: Two Other Reasons</div>
            <p class="card-desc">Resentment tells one loud story. Detective mode finds other possible reasonsâ€”so you can choose fair actions.</p>

            <div class="tinyGrid" role="group" aria-label="Detective choices">
              <button class="tinyChoice" onclick="pickDetective(1)">Maybe it was a mistake.</button>
              <button class="tinyChoice" onclick="pickDetective(2)">Maybe they didnâ€™t know.</button>
              <button class="tinyChoice" onclick="pickDetective(3)">Maybe they were having a hard day.</button>
            </div>

            <div class="mini-panel" style="margin-top:12px;">
              <div class="pill" id="detPill">Clue</div>
              <div style="font-weight:900; font-size:18px; margin-top:10px;" id="detLine">Pick a clue to practice.</div>
              <div style="color:#64748B; margin-top:6px; font-weight:800;" id="detHelp">This helps your brain calm down before you act.</div>
            </div>

            <button class="btn btn-amber" onclick="makeDetectiveQuestion()">Make a calm question</button>
            <div class="result" id="detResult"></div>
          </div>

          <!-- TOOL 4: Bridge Builder (repair script) -->
          <div class="white-card" style="border-bottom-color:#0EA5E9;">
            ${scene("ğŸ§‘â€ğŸ¤â€ğŸ§‘","ğŸ’¬","ğŸ«¶","ğŸ“¨","floaty","altA", "sceneBridge")}
            <div class="card-title" style="color:#0EA5E9;">Bridge Builder Script</div>
            <p class="card-desc">A short script helps you speak up without attacking. It builds a bridge, not a battle.</p>

            <div class="inputRow">
              <input id="whoInput" type="text" placeholder="Who is it with? (example: â€œSamâ€)" />
              <textarea id="whatInput" placeholder="What happened? (example: â€œYou said it was my fault.â€)"></textarea>
            </div>

            <button class="btn btn-sky" onclick="buildBridge()">Build my script</button>
            <div class="result" id="bridgeResult"></div>
          </div>

          <!-- TOOL 5: Unstick Checklist -->
          <div class="white-card" style="border-bottom-color:#0D9488;">
            ${scene("ğŸ§¼","ğŸ‘","ğŸŒ¬ï¸","âœ¨","floaty","altC", "sceneUnstick")}
            <div class="card-title" style="color:#0D9488;">Unstick My Heart Checklist</div>
            <p class="card-desc">Tiny body moves can loosen the grudge feelingâ€”so your words can be kinder.</p>

            <div class="checklist" aria-label="Unstick checklist">
              <div class="checkItem">
                <input id="u1" type="checkbox" onchange="updateUnstick()" />
                <label for="u1">Unclench your jaw (soft teeth, soft tongue).</label>
              </div>
              <div class="checkItem">
                <input id="u2" type="checkbox" onchange="updateUnstick()" />
                <label for="u2">Open your hands (no fists for 5 seconds).</label>
              </div>
              <div class="checkItem">
                <input id="u3" type="checkbox" onchange="updateUnstick()" />
                <label for="u3">Pick one â€œtiny fair stepâ€ instead of payback.</label>
              </div>
            </div>

            <div class="meter" id="unstickMeter">
              <span>Unstick Meter</span>
              <span id="unstickValue">0 / 3</span>
            </div>
          </div>

          <!-- TOOL 6: Body tool (active animation) -->
          <div class="white-card" style="border-bottom-color:#16A34A;">
            ${scene("âœ‹","ğŸ’ª","ğŸ§ ","ğŸŒ¡ï¸","wobble","altB", "scenePress")}
            <div class="card-title" style="color:#16A34A;">Palm-Press Reset</div>
            <p class="card-desc">Press-and-release helps your muscles soften. When your body relaxes, your thoughts get less â€œspiky.â€</p>

            <div class="mini-panel">
              <div class="pill" id="pressPill">Count</div>
              <div style="font-weight:900; font-size:22px; margin-top:10px;" id="pressCount">0 / 10</div>
              <div style="color:#64748B; margin-top:6px; font-weight:800;" id="pressHelp">Press palms 3 secondsâ€¦ relax 3 seconds.</div>
            </div>

            <div class="rowBtns">
              <button class="btn btn-green" style="margin-top:0;" onclick="doPress()">Press & Release</button>
              <button class="btn btn-teal" style="margin-top:0;" onclick="resetPress()">Reset</button>
              <button class="btn btn-indigo" style="margin-top:0;" onclick="finishPress()">Finish with a calm line</button>
            </div>

            <div class="result" id="pressResult"></div>
          </div>

        </div>

        <div style="text-align:center; margin-top:26px;">
          <a href="index.html" class="backLink">â† Back to Menu</a>
        </div>
      `;

      resetToolStates();
      renderTimer();
    }

    // ===== Tool 1: Timer =====
    let timerRemaining = 60;
    let timerRunning = false;

    function fmtTime(s){
      const mm = String(Math.floor(s/60)).padStart(2,'0');
      const ss = String(s%60).padStart(2,'0');
      return `${mm}:${ss}`;
    }

    function renderTimer(){
      const face = document.getElementById('timerFace');
      const bar  = document.getElementById('timerBar');
      const hint = document.getElementById('timerHint');
      if(face) face.textContent = fmtTime(timerRemaining);
      if(bar){
        const pct = ((60 - timerRemaining) / 60) * 100;
        bar.style.width = `${Math.max(0, Math.min(100, pct))}%`;
      }
      if(hint){
        if(timerRemaining > 40) hint.textContent = "Breathe slowâ€¦";
        else if(timerRemaining > 20) hint.textContent = "Shoulders downâ€¦";
        else if(timerRemaining > 0) hint.textContent = "Soft faceâ€¦ soft handsâ€¦";
        else hint.textContent = "Nice! Your brain is back.";
      }
    }

    function startTimer(){
      pingScene('sceneTimer','pop');
      if(timerRunning) return;
      timerRunning = true;

      addInterval(setInterval(()=>{
        if(!timerRunning) return;
        timerRemaining = Math.max(0, timerRemaining - 1);
        renderTimer();
        if(timerRemaining === 0){
          timerRunning = false;
          pingScene('sceneTimer','shake');
          addTimeout(setTimeout(()=>{
            timerRemaining = 60;
            renderTimer();
          }, 900));
        }
      }, 1000));
    }

    function pauseTimer(){
      pingScene('sceneTimer','shake');
      timerRunning = false;
    }

    function resetTimer(){
      timerRunning = false;
      timerRemaining = 60;
      renderTimer();
      pingScene('sceneTimer','pop');
    }

    // ===== Tool 2: Words builder =====
    function buildWords(){
      pingScene('sceneWords','pop');
      const unfair = ((document.getElementById('unfairInput')||{}).value||"").trim();
      const need   = ((document.getElementById('needInput')||{}).value||"").trim();
      const out    = document.getElementById('wordsResult');
      if(!out) return;

      const a = unfair ? `when ${unfair}` : "when ____";
      const b = need ? `${need}` : "____";

      out.style.display = 'block';
      out.innerHTML =
        `<div>Try this:</div>
         <div style="margin-top:8px;">â€œI felt upset ${a}.â€</div>
         <div style="margin-top:6px;">â€œWhat I needed was: ${b}.â€</div>
         <div style="margin-top:6px;">â€œCan we try a fair fix?â€</div>
         <small>Why it helps: Clear words calm the brain and protect friendships.</small>`;
    }

    // ===== Tool 3: Detective =====
    let detectiveHintShown = false;
    let detectiveClue = 0;

    function pickDetective(n){
      detectiveClue = n;
      pingScene('sceneDetective','pop');

      const pill = document.getElementById('detPill');
      const line = document.getElementById('detLine');
      const help = document.getElementById('detHelp');

      if(!pill || !line || !help) return;

      if(n === 1){
        pill.textContent = "Clue: Mistake";
        line.textContent = "Mistakes happenâ€”even to good people.";
        help.textContent = "Try a calm question before you decide the story.";
      }else if(n === 2){
        pill.textContent = "Clue: Didnâ€™t know";
        line.textContent = "They might not know it hurt you.";
        help.textContent = "Your words can teach themâ€”kindly.";
      }else{
        pill.textContent = "Clue: Hard day";
        line.textContent = "A hard day can make people act weird.";
        help.textContent = "You can be fair AND protect yourself.";
      }
    }

    function makeDetectiveQuestion(){
      pingScene('sceneDetective','shake');
      const out = document.getElementById('detResult');
      if(!out) return;

      let q = "â€œCan you help me understand what happened?â€";
      if(detectiveClue === 1) q = "â€œWas that a mistake, or did you mean it?â€";
      if(detectiveClue === 2) q = "â€œDid you know that hurt my feelings?â€";
      if(detectiveClue === 3) q = "â€œAre you having a hard day, or was it about me?â€";

      out.style.display = 'block';
      out.innerHTML =
        `<div>Calm question:</div>
         <div style="margin-top:8px;">${q}</div>
         <small>Why it helps: Questions turn guessing into facts.</small>`;

      detectiveHintShown = true;
    }

    // ===== Tool 4: Bridge script =====
    function buildBridge(){
      pingScene('sceneBridge','pop');
      const who  = ((document.getElementById('whoInput')||{}).value||"").trim() || "____";
      const what = ((document.getElementById('whatInput')||{}).value||"").trim();
      const out  = document.getElementById('bridgeResult');
      if(!out) return;

      const eventLine = what ? `When ${what},` : "When ____,";

      out.style.display = 'block';
      out.innerHTML =
        `<div>Practice script:</div>
         <div style="margin-top:8px;">â€œHey ${who}. ${eventLine} I felt upset. I want a fair fix. Can we talk for 2 minutes?â€</div>
         <small>Why it helps: A bridge script keeps your voice calm and clear.</small>`;
    }

    // ===== Tool 5: Unstick checklist =====
    function updateUnstick(){
      const a = (document.getElementById('u1')||{}).checked ? 1 : 0;
      const b = (document.getElementById('u2')||{}).checked ? 1 : 0;
      const c = (document.getElementById('u3')||{}).checked ? 1 : 0;
      const total = a + b + c;

      const v = document.getElementById('unstickValue');
      if(v) v.textContent = `${total} / 3`;

      if(total > 0) pingScene('sceneUnstick','pop');
      if(total === 3) pingScene('sceneUnstick','shake');
    }

    // ===== Tool 6: Press tool =====
    let press = 0;
    function doPress(){
      press = Math.min(10, press + 1);
      pingScene('scenePress','shake');

      const count = document.getElementById('pressCount');
      const help  = document.getElementById('pressHelp');
      if(count) count.textContent = `${press} / 10`;
      if(help){
        help.textContent = (press >= 10)
          ? "Nice! Your body is softer now."
          : "Press 3â€¦2â€¦1â€¦ relax 3â€¦2â€¦1â€¦";
      }
    }

    function resetPress(){
      press = 0;
      pingScene('scenePress','pop');
      const count = document.getElementById('pressCount');
      const help  = document.getElementById('pressHelp');
      const out   = document.getElementById('pressResult');
      if(count) count.textContent = "0 / 10";
      if(help) help.textContent = "Press palms 3 secondsâ€¦ relax 3 seconds.";
      if(out){ out.style.display = 'none'; out.textContent = ""; }
    }

    function finishPress(){
      pingScene('scenePress','pop');
      const out = document.getElementById('pressResult');
      if(!out) return;

      out.style.display = 'block';
      out.innerHTML =
        `<div>Calm finish line:</div>
         <div style="margin-top:8px;">â€œI can be fair and kind. I can choose smart words.â€</div>
         <small>Tip: Say it once in a quiet voice. Then choose one tiny next step.</small>`;
    }

    function resetToolStates(){
      timerRemaining = 60;
      timerRunning = false;
      detectiveClue = 0;
      detectiveHintShown = false;
      press = 0;
    }

    // Never blank page on load:
    showHome();
  </script>
</body>
</html>
